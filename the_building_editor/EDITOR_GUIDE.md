# 建物データエディタ 使用ガイド

## 概要

このエディタは、ハイブリッド空調システムの建物データを入力・編集し、JSON形式で保存・読み込みできるWebアプリケーションです。

## 主な機能

### ✅ データ入力機能
- **建物情報**: 建物名、所在地、延床面積
- **階**: 各階の名称と面積
- **大ゾーン**: 全館空調が担当する空調ゾーン
- **小ゾーン**: 個別空調が担当する空調ゾーン
- **部屋**: 各部屋の情報と所属ゾーン
- **全館空調設備**: チラー、AHU、VAV
- **個別空調設備**: VRF室外機
- **センサー**: 温度、湿度、電力などの各種センサー

### ✅ データ管理機能
- **サンプルデータ読込**: ワンクリックで東京グリーンタワーのサンプルデータを読み込み
- **JSONエクスポート**: 入力したデータをJSON形式でダウンロード
- **JSONインポート**: 保存したJSONファイルを読み込んで編集を再開
- **JSON表示**: リアルタイムでJSON構造を確認
- **統計表示**: 入力データの集計をフッターに表示

## 使い方

### 1. 初めて使う場合

#### ステップ1: サンプルデータを読み込む
1. 画面上部の **「サンプルデータ読込」** ボタンをクリック
2. 東京グリーンタワーのデータが自動的に入力されます
3. これを参考にして、自分の建物データを編集できます

#### ステップ2: 各タブで情報を確認・編集
- **建物情報タブ**: 建物の基本情報を入力
- **階タブ**: 階を追加・編集
- **ゾーンタブ**: 大ゾーンと小ゾーンを設定
- **部屋タブ**: 各部屋の情報を入力
- **全館空調タブ**: チラー、AHU、VAVを設定
- **個別空調タブ**: VRF室外機を設定
- **センサータブ**: 各種センサーを配置

#### ステップ3: データを保存
1. **「JSONエクスポート」** ボタンをクリック
2. `building_data_[建物ID].json` という名前でファイルがダウンロードされます

### 2. ゼロから入力する場合

#### ステップ1: 建物情報の入力
1. **建物情報タブ** を開く
2. 以下の項目を入力:
   - 建物ID (例: Building_A)
   - 建物名 (例: 大阪ビジネスタワー)
   - 所在地 (例: 大阪府大阪市)
   - 延床面積 (例: 5000 ㎡)

#### ステップ2: 階の追加
1. **階タブ** を開く
2. **「階を追加」** ボタンをクリック
3. 各階について以下を入力:
   - ID (例: Floor_1)
   - 名称 (例: 1階)
   - 面積 (例: 2500 ㎡)

#### ステップ3: 空調設備の追加
1. **全館空調タブ** または **個別空調タブ** を開く
2. 各設備を追加:
   - チラー: **「チラー追加」** ボタン
   - AHU: **「AHU追加」** ボタン
   - VAV: **「VAV追加」** ボタン
   - VRF: **「VRF追加」** ボタン

#### ステップ4: ゾーンの設定
1. **ゾーンタブ** を開く
2. 大ゾーンを追加:
   - **「大ゾーン追加」** ボタンをクリック
   - 名称、所属階、担当AHUを選択
3. 小ゾーンを追加:
   - **「小ゾーン追加」** ボタンをクリック
   - 名称、所属大ゾーン、担当VRFを選択

#### ステップ5: 部屋の追加
1. **部屋タブ** を開く
2. **「部屋を追加」** ボタンをクリック
3. 各部屋について:
   - ID、名称、所属小ゾーン、面積を入力

#### ステップ6: センサーの配置
1. **センサータブ** を開く
2. **「センサー追加」** ボタンをクリック
3. 各センサーについて:
   - ID、名称、種類、設備ID、単位を入力

#### ステップ7: データの保存
1. **「JSONエクスポート」** ボタンでダウンロード

### 3. 保存したデータを編集する場合

1. **「JSONインポート」** ボタンをクリック
2. 以前保存した `.json` ファイルを選択
3. データが読み込まれ、編集を再開できます
4. 編集後、再度 **「JSONエクスポート」** で保存

## データ構造の理解

### 階層関係
```
建物 (Building)
  └─ 階 (Floor)
      └─ 大ゾーン (Large Zone) ← 全館空調が担当
          └─ 小ゾーン (Small Zone) ← 個別空調が担当
              └─ 部屋 (Room)
```

### 空調システムの接続
```
チラー (Chiller)
  └─ AHU (外調機)
      └─ VAV (変風量ユニット)
          └─ 大ゾーン (Large Zone)

VRF (室外機)
  └─ 小ゾーン (Small Zone)
```

### 横断的構成
- 1台のVRFが複数の大ゾーンにまたがって小ゾーンに供給することが可能
- 例: VRF_Unit_1 → 大ゾーン1Aの小ゾーン1A1、1A2 + 大ゾーン1Bの小ゾーン1B1

## 主要な操作

### アイテムの追加
- 各タブの **「〇〇を追加」** ボタンをクリック
- 新しい行が追加され、情報を入力できます

### アイテムの編集
- 各入力フィールドに直接入力
- ドロップダウンで関連する設備やゾーンを選択
- 変更は即座に反映されます

### アイテムの削除
- 各行の右端にある **ゴミ箱アイコン** をクリック
- 確認なく削除されるので注意してください

### JSON構造の確認
- **「JSON表示」** ボタンをクリック
- リアルタイムでJSONデータを確認できます
- もう一度クリックすると非表示になります

## JSONファイルの形式

エクスポートされるJSONは以下の構造を持ちます:

```json
{
  "building": {
    "id": "Building_A",
    "name": "東京グリーンタワー",
    "location": "東京都千代田区",
    "totalArea": 2400
  },
  "floors": [
    {
      "id": "Floor_1",
      "name": "1階",
      "area": 1200
    }
  ],
  "largeZones": [
    {
      "id": "LargeZone_1A",
      "name": "大ゾーン1A(東側エリア)",
      "floorId": "Floor_1",
      "ahuId": "AHU_1"
    }
  ],
  "smallZones": [
    {
      "id": "SmallZone_1A1",
      "name": "小ゾーン1A1(会議室エリア)",
      "largeZoneId": "LargeZone_1A",
      "vrfId": "VRF_Unit_1"
    }
  ],
  "rooms": [
    {
      "id": "Room_101",
      "name": "会議室101",
      "smallZoneId": "SmallZone_1A1",
      "area": 30
    }
  ],
  "centralHVAC": {
    "chillers": [...],
    "ahus": [...],
    "vavs": [...]
  },
  "individualHVAC": {
    "vrfs": [...]
  },
  "sensors": [...]
}
```

## よくある質問

### Q1: データが消えないか心配です
**A**: エディタはブラウザ上で動作するため、ページをリロードするとデータが消えます。必ず **「JSONエクスポート」** でファイルに保存してください。

### Q2: 複数の建物を管理できますか?
**A**: はい。各建物のデータを別々のJSONファイルとして保存し、必要に応じて **「JSONインポート」** で切り替えられます。

### Q3: IDの命名規則は?
**A**: 
- 英数字とアンダースコア(_)のみ使用
- 同じ種類のアイテム内でユニークなIDを使用
- 例: `Floor_1`, `LargeZone_1A`, `Room_101`

### Q4: VRFが複数の大ゾーンをまたぐ場合は?
**A**: 小ゾーンごとに異なる大ゾーンを選択できます。同じVRF IDを複数の小ゾーンに設定することで、横断的な構成を表現できます。

### Q5: センサーの設備IDとは?
**A**: センサーが取り付けられている設備のIDです。例:
- `AHU_1` (外調機のセンサー)
- `Chiller_1` (チラーのセンサー)
- `Room_101` (部屋のセンサー)

### Q6: エクスポートしたJSONをBrick Schemaに変換できますか?
**A**: はい。別途、JSONからTurtle形式への変換ツールを使用することで、Brick Schemaに準拠したRDFデータを生成できます。

## データ入力のベストプラクティス

### 1. 下から上へ入力する
推奨順序:
1. 建物情報
2. 空調設備 (チラー、AHU、VRF)
3. 階
4. 大ゾーン (AHUと関連付け)
5. 小ゾーン (VRFと関連付け)
6. 部屋
7. センサー

この順序で入力すると、ドロップダウンで選択肢が表示されやすくなります。

### 2. 命名規則を統一する
- **階**: `Floor_1`, `Floor_2`, ...
- **大ゾーン**: `LargeZone_1A`, `LargeZone_1B`, ...
- **小ゾーン**: `SmallZone_1A1`, `SmallZone_1A2`, ...
- **部屋**: `Room_101`, `Room_102`, ...

### 3. こまめに保存する
- 大きな変更を加える前にエクスポート
- 異なるバージョンを別ファイルとして保存

### 4. JSON表示で確認する
- 入力後、JSON表示ボタンで構造を確認
- 意図しない参照エラーがないかチェック

## トラブルシューティング

### 問題: ドロップダウンに選択肢が表示されない
**解決策**: 
- 参照先のデータ (階、設備など) を先に作成してください
- ページをリロードすると編集中のデータが失われるので注意

### 問題: JSONインポートでエラーが出る
**解決策**: 
- JSONファイルの形式が正しいか確認してください
- テキストエディタで開いて構文エラーがないかチェック

### 問題: エクスポートしたファイルが開けない
**解決策**: 
- ファイル拡張子が `.json` であることを確認
- テキストエディタで開いてデータを確認

## サポート

問題が解決しない場合は、以下の情報を含めてお問い合わせください:
- 使用しているブラウザとバージョン
- 実行した操作の手順
- エラーメッセージ (表示された場合)
- エクスポートしたJSONファイル (可能な場合)

## 関連ドキュメント

- `README.md` - 情報モデルの詳細説明
- `QUICK_REFERENCE.md` - Brick Schemaのクイックリファレンス
- `hvac_information_model.ttl` - Brick Schemaでの情報モデル定義
- `test_queries.sparql` - データ検証用のSPARQLクエリ

---

**バージョン**: 1.0  
**最終更新**: 2025年10月23日
