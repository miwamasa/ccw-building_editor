<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âª∫Áâ©„É¢„Éá„É´„ÉØ„Éº„ÇØ„Éô„É≥„ÉÅ - Building Model Workbench</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }

        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .sidebar-section h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-button {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 8px;
            border: none;
            border-radius: 6px;
            background: #f5f5f5;
            color: #333;
            font-size: 14px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-button:hover {
            background: #e0e0e0;
        }

        .nav-button.active {
            background: #667eea;
            color: white;
        }

        .workspace {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .toolbar {
            background: white;
            padding: 15px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .card h2 {
            font-size: 18px;
            margin-bottom: 16px;
            color: #333;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d0d0d0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th {
            background: #f5f5f5;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            color: #555;
            border-bottom: 2px solid #e0e0e0;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        td input,
        td select {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            font-size: 13px;
        }

        .delete-btn {
            background: #f56565;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .delete-btn:hover {
            background: #e53e3e;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
        }

        .chat-message {
            margin-bottom: 16px;
            padding: 12px 16px;
            border-radius: 8px;
            max-width: 80%;
        }

        .chat-message.user {
            background: #667eea;
            color: white;
            margin-left: auto;
        }

        .chat-message.assistant {
            background: white;
            border: 1px solid #e0e0e0;
        }

        .chat-input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input textarea {
            flex: 1;
            padding: 12px;
            border: 1px solid #d0d0d0;
            border-radius: 6px;
            resize: none;
            font-family: inherit;
            font-size: 14px;
        }

        .mapping-result {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 6px;
            padding: 12px;
            margin-top: 10px;
        }

        .mapping-item {
            padding: 8px;
            margin-bottom: 8px;
            background: white;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .confidence-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .confidence-high {
            background: #d1fae5;
            color: #065f46;
        }

        .confidence-medium {
            background: #fed7aa;
            color: #92400e;
        }

        .confidence-low {
            background: #fecaca;
            color: #991b1b;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: 700;
            color: #333;
        }

        .json-viewer {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 600px;
            overflow-y: auto;
        }

        .file-input-label {
            display: inline-block;
            padding: 8px 16px;
            background: #e0e0e0;
            color: #333;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .file-input-label:hover {
            background: #d0d0d0;
        }

        input[type="file"] {
            display: none;
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .status-connected {
            background: #48bb78;
        }

        .status-disconnected {
            background: #f56565;
        }

        .api-config {
            background: #fffbeb;
            border: 1px solid #fbbf24;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .api-config h3 {
            font-size: 14px;
            color: #92400e;
            margin-bottom: 12px;
        }

        .instruction-box {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 16px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .instruction-box h3 {
            font-size: 16px;
            color: #0c4a6e;
            margin-bottom: 8px;
        }

        .instruction-box p {
            font-size: 14px;
            color: #075985;
            line-height: 1.6;
        }

        .sensor-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 12px;
        }

        .sensor-item {
            padding: 10px;
            margin-bottom: 8px;
            background: #f9f9f9;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sensor-item:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // „É°„Ç§„É≥„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
        const BuildingModelWorkbench = () => {
            const [currentView, setCurrentView] = useState('editor');
            const [buildingData, setBuildingData] = useState({
                building: { id: '', name: '', location: '', totalArea: 0 },
                floors: [],
                largeZones: [],
                smallZones: [],
                rooms: [],
                centralHVAC: { chillers: [], ahus: [], vavs: [] },
                individualHVAC: { vrfs: [] },
                sensors: []
            });
            const [physicalSensors, setPhysicalSensors] = useState([]);
            const [sensorMappings, setSensorMappings] = useState([]);
            const [chatMessages, setChatMessages] = useState([]);
            const [apiKey, setApiKey] = useState('');
            const [apiProvider, setApiProvider] = useState('openai');
            const [apiModel, setApiModel] = useState('gpt-4o-mini');
            const [apiEndpoint, setApiEndpoint] = useState('');
            const [queryPromptTemplate, setQueryPromptTemplate] = useState(`„ÅÇ„Å™„Åü„ÅØÂª∫Áâ©„ÅÆ„Çª„É≥„Çµ„ÉºÊÉÖÂ†±„ÇíÊ§úÁ¥¢„ÉªÂàÜÊûê„Åô„ÇãAI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà„Åß„Åô„ÄÇ

‰ª•‰∏ã„ÅÆÂª∫Áâ©„Éá„Éº„Çø„ÅåÊèê‰æõ„Åï„Çå„Åæ„ÅôÔºö
<building_data>
{buildingData}
</building_data>

‰ª•‰∏ã„ÅÆ„Çª„É≥„Çµ„Éº„Éû„ÉÉ„Éî„É≥„Ç∞ÊÉÖÂ†±„ÅåÊèê‰æõ„Åï„Çå„Åæ„ÅôÔºö
<sensor_mapping>
{sensorMappings}
</sensor_mapping>

„É¶„Éº„Ç∂„Éº„Åã„Çâ„ÅÆË≥™Âïè„Å´Âü∫„Å•„ÅÑ„Å¶„ÄÅË©≤ÂΩì„Åô„Çã„Çª„É≥„Çµ„Éº„ÇíÁâπÂÆö„Åó„ÄÅÁîüÊàê„Çª„É≥„Çµ„ÉºÔºàgenerated sensorÔºâ„Å®ÂØæÂøú„Åô„ÇãÁâ©ÁêÜ„Çª„É≥„Çµ„ÉºÔºàphysical sensorÔºâ„ÅÆÊÉÖÂ†±„Çí‰ΩµË®ò„Åó„Å¶JSONÂΩ¢Âºè„ÅßÂõûÁ≠î„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

Âá¶ÁêÜÊâãÈ†ÜÔºö
1. „É¶„Éº„Ç∂„Éº„ÅÆË≥™Âïè„ÇíÂàÜÊûê„Åó„ÄÅÊ±Ç„ÇÅ„Çâ„Çå„Å¶„ÅÑ„Çã„Çª„É≥„Çµ„Éº„ÅÆÁ®ÆÈ°û„ÇÑË®≠ÁΩÆÂ†¥ÊâÄ„ÇíÁâπÂÆö„Åô„Çã
2. Âª∫Áâ©„Éá„Éº„Çø„ÅÆsensors„É™„Çπ„Éà„Åã„Çâ„ÄÅË≥™Âïè„Å´Ë©≤ÂΩì„Åô„Çã„Çª„É≥„Çµ„Éº„ÇíÊ§úÁ¥¢„Åô„ÇãÔºà„Çª„É≥„Çµ„ÉºÂêç„ÄÅ„Çø„Ç§„Éó„ÄÅË®≠ÁΩÆÂ†¥ÊâÄ„Å™„Å©„ÇíËÄÉÊÖÆÔºâ
3. ÁâπÂÆö„Åó„ÅüÂêÑ„Çª„É≥„Çµ„Éº„Å´„Å§„ÅÑ„Å¶„ÄÅ„Çª„É≥„Çµ„Éº„Éû„ÉÉ„Éî„É≥„Ç∞ÊÉÖÂ†±„Åã„ÇâÂØæÂøú„Åô„ÇãÁâ©ÁêÜ„Çª„É≥„Çµ„Éº„ÅÆÊÉÖÂ†±„ÇíÂèñÂæó„Åô„Çã
4. ÁµêÊûú„ÇíJSONÂΩ¢Âºè„ÅßÂá∫Âäõ„Åô„Çã

Âá∫ÂäõÂΩ¢ÂºèÔºö
\`\`\`json
{
  "sensorlist": [
    {
      "generated": "ÁîüÊàê„Çª„É≥„Çµ„ÉºÂêçÔºàgeneratedSensorNameÔºâ",
      "concrete": "Áâ©ÁêÜ„Çª„É≥„Çµ„ÉºÂêçÔºàphysicalSensorNameÔºâ"
    }
  ]
}
\`\`\`

Ê≥®ÊÑè‰∫ãÈ†ÖÔºö
- „Çª„É≥„Çµ„Éº„Éû„ÉÉ„Éî„É≥„Ç∞ÊÉÖÂ†±„Å´„Å™„ÅÑÁîüÊàê„Çª„É≥„Çµ„Éº„ÅÆÂ†¥Âêà„ÅØ„ÄÅ"concrete"„Éï„Ç£„Éº„É´„Éâ„Å´"„Éû„ÉÉ„Éî„É≥„Ç∞ÊÉÖÂ†±„Å™„Åó"„Å®Ë®òËºâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
- Ë≥™Âïè„Å´Ë©≤ÂΩì„Åô„Çã„Çª„É≥„Çµ„Éº„ÅåË§áÊï∞„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Åô„Åπ„Å¶„É™„Çπ„Éà„Å´Âê´„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ
- „Çª„É≥„Çµ„ÉºÂêç„ÅØÊ≠£Á¢∫„Å´„Éá„Éº„Çø„Åã„ÇâÂèñÂæó„Åó„Å¶„Åè„Å†„Åï„ÅÑ

Ë≥™ÂïèÔºö
{query}`);

            // „Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÅÆ„É≠„Éº„Éâ
            const loadSampleData = () => {
                const sample = {
                    building: {
                        id: 'Building_A',
                        name: 'Êù±‰∫¨„Ç∞„É™„Éº„É≥„Çø„ÉØ„Éº',
                        location: 'Êù±‰∫¨ÈÉΩÂçÉ‰ª£Áî∞Âå∫',
                        totalArea: 2400
                    },
                    floors: [
                        { id: 'Floor_1', name: '1Èöé', area: 1200 },
                        { id: 'Floor_2', name: '2Èöé', area: 1200 }
                    ],
                    largeZones: [
                        { id: 'LargeZone_1A', name: 'Â§ß„Çæ„Éº„É≥1A(Êù±ÂÅ¥„Ç®„É™„Ç¢)', floorId: 'Floor_1', ahuId: 'AHU_1' },
                        { id: 'LargeZone_1B', name: 'Â§ß„Çæ„Éº„É≥1B(Ë•øÂÅ¥„Ç®„É™„Ç¢)', floorId: 'Floor_1', ahuId: 'AHU_1' },
                        { id: 'LargeZone_2A', name: 'Â§ß„Çæ„Éº„É≥2A(ÂÖ®„Éï„É≠„Ç¢)', floorId: 'Floor_2', ahuId: 'AHU_2' }
                    ],
                    smallZones: [
                        { id: 'SmallZone_1A1', name: 'Â∞è„Çæ„Éº„É≥1A1(‰ºöË≠∞ÂÆ§„Ç®„É™„Ç¢)', largeZoneId: 'LargeZone_1A', vrfId: 'VRF_Unit_1' },
                        { id: 'SmallZone_1A2', name: 'Â∞è„Çæ„Éº„É≥1A2(„Ç™„Éï„Ç£„Çπ„Ç®„É™„Ç¢)', largeZoneId: 'LargeZone_1A', vrfId: 'VRF_Unit_1' },
                        { id: 'SmallZone_1B1', name: 'Â∞è„Çæ„Éº„É≥1B1(Âü∑ÂãôÂÆ§„Ç®„É™„Ç¢)', largeZoneId: 'LargeZone_1B', vrfId: 'VRF_Unit_1' }
                    ],
                    rooms: [
                        { id: 'Room_101', name: '‰ºöË≠∞ÂÆ§101', smallZoneId: 'SmallZone_1A1', area: 30 },
                        { id: 'Room_102', name: '‰ºöË≠∞ÂÆ§102', smallZoneId: 'SmallZone_1A1', area: 30 },
                        { id: 'Room_103', name: '„Ç™„Éï„Ç£„Çπ103', smallZoneId: 'SmallZone_1A2', area: 50 }
                    ],
                    centralHVAC: {
                        chillers: [
                            { id: 'Chiller_1', name: '„ÉÅ„É©„Éº1Âè∑Ê©ü', capacity: 150, powerRating: 50 }
                        ],
                        ahus: [
                            { id: 'AHU_1', name: 'Â§ñË™øÊ©ü1Âè∑Ê©ü(1ÈöéÊãÖÂΩì)', chillerId: 'Chiller_1', airflow: 10000 },
                            { id: 'AHU_2', name: 'Â§ñË™øÊ©ü2Âè∑Ê©ü(2ÈöéÊãÖÂΩì)', chillerId: 'Chiller_1', airflow: 8000 }
                        ],
                        vavs: [
                            { id: 'VAV_1A1', name: 'VAV 1A-1', ahuId: 'AHU_1', largeZoneId: 'LargeZone_1A' }
                        ]
                    },
                    individualHVAC: {
                        vrfs: [
                            { id: 'VRF_Unit_1', name: 'VRFÂÆ§Â§ñÊ©ü1Âè∑Ê©ü', capacity: 40, powerRating: 15 }
                        ]
                    },
                    sensors: [
                        // Âª∫Áâ©ÂÖ®‰Ωì„Çª„É≥„Çµ„Éº („Ç™„É≥„Éà„É≠„Ç∏„Éº„Éô„Éº„ÇπÂëΩÂêçË¶èÂâá: BLD:EntityID:Context:Type)
                        { id: 'BLD:Building_A:OUT:TEMP', name: 'Âª∫Áâ©Â§ñÊ∞óÊ∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'Building_A', unit: '¬∞C' },
                        { id: 'BLD:Building_A:OUT:HUMD', name: 'Âª∫Áâ©Â§ñÊ∞óÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'Building_A', unit: '%RH' },
                        { id: 'BLD:Building_A:TOTAL:POWR', name: 'Âª∫Áâ©Á∑èÈõªÂäõÈáè„Çª„É≥„Çµ„Éº', type: 'power', equipmentId: 'Building_A', unit: 'kW' },

                        // „ÉÅ„É©„Éº1Âè∑Ê©ü„Çª„É≥„Çµ„Éº (CHL:EntityID:Context:Type)
                        { id: 'CHL:Chiller_1:SUP_WTR:TEMP', name: '„ÉÅ„É©„Éº1_ÈÄÅÊ∞¥Ê∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'Chiller_1', unit: '¬∞C' },
                        { id: 'CHL:Chiller_1:RET_WTR:TEMP', name: '„ÉÅ„É©„Éº1_ÈÇÑÊ∞¥Ê∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'Chiller_1', unit: '¬∞C' },
                        { id: 'CHL:Chiller_1:WTR_FLW:FLOW', name: '„ÉÅ„É©„Éº1_Ê∞¥ÊµÅÈáè„Çª„É≥„Çµ„Éº', type: 'flow', equipmentId: 'Chiller_1', unit: 'L/min' },
                        { id: 'CHL:Chiller_1:UNIT:POWR', name: '„ÉÅ„É©„Éº1_ÈõªÂäõ„Çª„É≥„Çµ„Éº', type: 'power', equipmentId: 'Chiller_1', unit: 'kW' },
                        { id: 'CHL:Chiller_1:UNIT:STAT', name: '„ÉÅ„É©„Éº1_ÈÅãËª¢Áä∂ÊÖã„Çª„É≥„Çµ„Éº', type: 'status', equipmentId: 'Chiller_1', unit: 'on/off' },

                        // Â§ñË™øÊ©ü1Âè∑Ê©ü„Çª„É≥„Çµ„Éº (AHU:EntityID:Context:Type)
                        { id: 'AHU:AHU_1:OUT:TEMP', name: 'Â§ñË™øÊ©ü1_Â§ñÊ∞óÊ∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'AHU_1', unit: '¬∞C' },
                        { id: 'AHU:AHU_1:OUT:HUMD', name: 'Â§ñË™øÊ©ü1_Â§ñÊ∞óÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'AHU_1', unit: '%RH' },
                        { id: 'AHU:AHU_1:SUP_AIR:TEMP', name: 'Â§ñË™øÊ©ü1_Áµ¶Ê∞óÊ∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'AHU_1', unit: '¬∞C' },
                        { id: 'AHU:AHU_1:SUP_AIR:HUMD', name: 'Â§ñË™øÊ©ü1_Áµ¶Ê∞óÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'AHU_1', unit: '%RH' },
                        { id: 'AHU:AHU_1:RET_AIR:TEMP', name: 'Â§ñË™øÊ©ü1_ÈÇÑÊ∞óÊ∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'AHU_1', unit: '¬∞C' },
                        { id: 'AHU:AHU_1:RET_AIR:HUMD', name: 'Â§ñË™øÊ©ü1_ÈÇÑÊ∞óÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'AHU_1', unit: '%RH' },
                        { id: 'AHU:AHU_1:AIR_FLW:FLOW', name: 'Â§ñË™øÊ©ü1_Áµ¶Ê∞óÈ¢®Èáè„Çª„É≥„Çµ„Éº', type: 'flow', equipmentId: 'AHU_1', unit: 'm¬≥/h' },
                        { id: 'AHU:AHU_1:DMPR:POS', name: 'Â§ñË™øÊ©ü1_„ÉÄ„É≥„Éë„ÉºÈñãÂ∫¶„Çª„É≥„Çµ„Éº', type: 'position', equipmentId: 'AHU_1', unit: '%' },
                        { id: 'AHU:AHU_1:FAN:SPD', name: 'Â§ñË™øÊ©ü1_„Éï„Ç°„É≥ÂõûËª¢Êï∞„Çª„É≥„Çµ„Éº', type: 'speed', equipmentId: 'AHU_1', unit: 'rpm' },
                        { id: 'AHU:AHU_1:UNIT:POWR', name: 'Â§ñË™øÊ©ü1_ÈõªÂäõ„Çª„É≥„Çµ„Éº', type: 'power', equipmentId: 'AHU_1', unit: 'kW' },
                        { id: 'AHU:AHU_1:FLTR:PRES', name: 'Â§ñË™øÊ©ü1_„Éï„Ç£„É´„ÇøÂ∑ÆÂúß„Çª„É≥„Çµ„Éº', type: 'pressure', equipmentId: 'AHU_1', unit: 'Pa' },

                        // Â§ñË™øÊ©ü2Âè∑Ê©ü„Çª„É≥„Çµ„Éº (AHU:EntityID:Context:Type)
                        { id: 'AHU:AHU_2:OUT:TEMP', name: 'Â§ñË™øÊ©ü2_Â§ñÊ∞óÊ∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'AHU_2', unit: '¬∞C' },
                        { id: 'AHU:AHU_2:OUT:HUMD', name: 'Â§ñË™øÊ©ü2_Â§ñÊ∞óÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'AHU_2', unit: '%RH' },
                        { id: 'AHU:AHU_2:SUP_AIR:TEMP', name: 'Â§ñË™øÊ©ü2_Áµ¶Ê∞óÊ∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'AHU_2', unit: '¬∞C' },
                        { id: 'AHU:AHU_2:SUP_AIR:HUMD', name: 'Â§ñË™øÊ©ü2_Áµ¶Ê∞óÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'AHU_2', unit: '%RH' },
                        { id: 'AHU:AHU_2:RET_AIR:TEMP', name: 'Â§ñË™øÊ©ü2_ÈÇÑÊ∞óÊ∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'AHU_2', unit: '¬∞C' },
                        { id: 'AHU:AHU_2:RET_AIR:HUMD', name: 'Â§ñË™øÊ©ü2_ÈÇÑÊ∞óÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'AHU_2', unit: '%RH' },
                        { id: 'AHU:AHU_2:AIR_FLW:FLOW', name: 'Â§ñË™øÊ©ü2_Áµ¶Ê∞óÈ¢®Èáè„Çª„É≥„Çµ„Éº', type: 'flow', equipmentId: 'AHU_2', unit: 'm¬≥/h' },
                        { id: 'AHU:AHU_2:DMPR:POS', name: 'Â§ñË™øÊ©ü2_„ÉÄ„É≥„Éë„ÉºÈñãÂ∫¶„Çª„É≥„Çµ„Éº', type: 'position', equipmentId: 'AHU_2', unit: '%' },
                        { id: 'AHU:AHU_2:FAN:SPD', name: 'Â§ñË™øÊ©ü2_„Éï„Ç°„É≥ÂõûËª¢Êï∞„Çª„É≥„Çµ„Éº', type: 'speed', equipmentId: 'AHU_2', unit: 'rpm' },
                        { id: 'AHU:AHU_2:UNIT:POWR', name: 'Â§ñË™øÊ©ü2_ÈõªÂäõ„Çª„É≥„Çµ„Éº', type: 'power', equipmentId: 'AHU_2', unit: 'kW' },
                        { id: 'AHU:AHU_2:FLTR:PRES', name: 'Â§ñË™øÊ©ü2_„Éï„Ç£„É´„ÇøÂ∑ÆÂúß„Çª„É≥„Çµ„Éº', type: 'pressure', equipmentId: 'AHU_2', unit: 'Pa' },

                        // VAV„Çª„É≥„Çµ„Éº (VAV:EntityID:Context:Type)
                        { id: 'VAV:VAV_1A1:SUP_AIR:TEMP', name: 'VAV1A-1_Áµ¶Ê∞óÊ∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'VAV_1A1', unit: '¬∞C' },
                        { id: 'VAV:VAV_1A1:DMPR:POS', name: 'VAV1A-1_„ÉÄ„É≥„Éë„ÉºÈñãÂ∫¶„Çª„É≥„Çµ„Éº', type: 'position', equipmentId: 'VAV_1A1', unit: '%' },
                        { id: 'VAV:VAV_1A1:AIR_FLW:FLOW', name: 'VAV1A-1_È¢®Èáè„Çª„É≥„Çµ„Éº', type: 'flow', equipmentId: 'VAV_1A1', unit: 'm¬≥/h' },

                        // VRFÂÆ§Â§ñÊ©ü„Çª„É≥„Çµ„Éº (VRF:EntityID:Context:Type)
                        { id: 'VRF:VRF_Unit_1:OUT:TEMP', name: 'VRF1_ÂÆ§Â§ñÊ©üÊ∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'VRF_Unit_1', unit: '¬∞C' },
                        { id: 'VRF:VRF_Unit_1:UNIT:POWR', name: 'VRF1_ÈõªÂäõ„Çª„É≥„Çµ„Éº', type: 'power', equipmentId: 'VRF_Unit_1', unit: 'kW' },
                        { id: 'VRF:VRF_Unit_1:UNIT:STAT', name: 'VRF1_ÈÅãËª¢Áä∂ÊÖã„Çª„É≥„Çµ„Éº', type: 'status', equipmentId: 'VRF_Unit_1', unit: 'on/off' },
                        { id: 'VRF:VRF_Unit_1:COMP:FREQ', name: 'VRF1_ÂúßÁ∏ÆÊ©üÂë®Ê≥¢Êï∞„Çª„É≥„Çµ„Éº', type: 'frequency', equipmentId: 'VRF_Unit_1', unit: 'Hz' },

                        // Â§ß„Çæ„Éº„É≥„Çª„É≥„Çµ„Éº (LZN:EntityID:Context:Type)
                        { id: 'LZN:LargeZone_1A:AMB:TEMP', name: 'Â§ß„Çæ„Éº„É≥1A_Ê∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'LargeZone_1A', unit: '¬∞C' },
                        { id: 'LZN:LargeZone_1A:AMB:HUMD', name: 'Â§ß„Çæ„Éº„É≥1A_ÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'LargeZone_1A', unit: '%RH' },
                        { id: 'LZN:LargeZone_1B:AMB:TEMP', name: 'Â§ß„Çæ„Éº„É≥1B_Ê∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'LargeZone_1B', unit: '¬∞C' },
                        { id: 'LZN:LargeZone_1B:AMB:HUMD', name: 'Â§ß„Çæ„Éº„É≥1B_ÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'LargeZone_1B', unit: '%RH' },
                        { id: 'LZN:LargeZone_2A:AMB:TEMP', name: 'Â§ß„Çæ„Éº„É≥2A_Ê∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'LargeZone_2A', unit: '¬∞C' },
                        { id: 'LZN:LargeZone_2A:AMB:HUMD', name: 'Â§ß„Çæ„Éº„É≥2A_ÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'LargeZone_2A', unit: '%RH' },

                        // Â∞è„Çæ„Éº„É≥„Çª„É≥„Çµ„Éº (SZN:EntityID:Context:Type)
                        { id: 'SZN:SmallZone_1A1:AMB:TEMP', name: 'Â∞è„Çæ„Éº„É≥1A1_Ê∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'SmallZone_1A1', unit: '¬∞C' },
                        { id: 'SZN:SmallZone_1A1:AMB:HUMD', name: 'Â∞è„Çæ„Éº„É≥1A1_ÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'SmallZone_1A1', unit: '%RH' },
                        { id: 'SZN:SmallZone_1A2:AMB:TEMP', name: 'Â∞è„Çæ„Éº„É≥1A2_Ê∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'SmallZone_1A2', unit: '¬∞C' },
                        { id: 'SZN:SmallZone_1A2:AMB:HUMD', name: 'Â∞è„Çæ„Éº„É≥1A2_ÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'SmallZone_1A2', unit: '%RH' },
                        { id: 'SZN:SmallZone_1B1:AMB:TEMP', name: 'Â∞è„Çæ„Éº„É≥1B1_Ê∏©Â∫¶„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'SmallZone_1B1', unit: '¬∞C' },
                        { id: 'SZN:SmallZone_1B1:AMB:HUMD', name: 'Â∞è„Çæ„Éº„É≥1B1_ÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'SmallZone_1B1', unit: '%RH' },

                        // ÈÉ®Â±ã„Çª„É≥„Çµ„Éº (ROM:EntityID:Context:Type)
                        { id: 'ROM:Room_101:AMB:TEMP', name: '‰ºöË≠∞ÂÆ§101_ÂÆ§Ê∏©„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'Room_101', unit: '¬∞C' },
                        { id: 'ROM:Room_101:AMB:HUMD', name: '‰ºöË≠∞ÂÆ§101_ÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'Room_101', unit: '%RH' },
                        { id: 'ROM:Room_101:AMB:CO2', name: '‰ºöË≠∞ÂÆ§101_CO2„Çª„É≥„Çµ„Éº', type: 'co2', equipmentId: 'Room_101', unit: 'ppm' },
                        { id: 'ROM:Room_101:AMB:OCCP', name: '‰ºöË≠∞ÂÆ§101_Âú®ÂÆ§„Çª„É≥„Çµ„Éº', type: 'occupancy', equipmentId: 'Room_101', unit: 'persons' },
                        { id: 'ROM:Room_101:AMB:ILLM', name: '‰ºöË≠∞ÂÆ§101_ÁÖßÂ∫¶„Çª„É≥„Çµ„Éº', type: 'illuminance', equipmentId: 'Room_101', unit: 'lx' },

                        { id: 'ROM:Room_102:AMB:TEMP', name: '‰ºöË≠∞ÂÆ§102_ÂÆ§Ê∏©„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'Room_102', unit: '¬∞C' },
                        { id: 'ROM:Room_102:AMB:HUMD', name: '‰ºöË≠∞ÂÆ§102_ÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'Room_102', unit: '%RH' },
                        { id: 'ROM:Room_102:AMB:CO2', name: '‰ºöË≠∞ÂÆ§102_CO2„Çª„É≥„Çµ„Éº', type: 'co2', equipmentId: 'Room_102', unit: 'ppm' },
                        { id: 'ROM:Room_102:AMB:OCCP', name: '‰ºöË≠∞ÂÆ§102_Âú®ÂÆ§„Çª„É≥„Çµ„Éº', type: 'occupancy', equipmentId: 'Room_102', unit: 'persons' },
                        { id: 'ROM:Room_102:AMB:ILLM', name: '‰ºöË≠∞ÂÆ§102_ÁÖßÂ∫¶„Çª„É≥„Çµ„Éº', type: 'illuminance', equipmentId: 'Room_102', unit: 'lx' },

                        { id: 'ROM:Room_103:AMB:TEMP', name: '„Ç™„Éï„Ç£„Çπ103_ÂÆ§Ê∏©„Çª„É≥„Çµ„Éº', type: 'temperature', equipmentId: 'Room_103', unit: '¬∞C' },
                        { id: 'ROM:Room_103:AMB:HUMD', name: '„Ç™„Éï„Ç£„Çπ103_ÊπøÂ∫¶„Çª„É≥„Çµ„Éº', type: 'humidity', equipmentId: 'Room_103', unit: '%RH' },
                        { id: 'ROM:Room_103:AMB:CO2', name: '„Ç™„Éï„Ç£„Çπ103_CO2„Çª„É≥„Çµ„Éº', type: 'co2', equipmentId: 'Room_103', unit: 'ppm' },
                        { id: 'ROM:Room_103:AMB:OCCP', name: '„Ç™„Éï„Ç£„Çπ103_Âú®ÂÆ§„Çª„É≥„Çµ„Éº', type: 'occupancy', equipmentId: 'Room_103', unit: 'persons' },
                        { id: 'ROM:Room_103:AMB:ILLM', name: '„Ç™„Éï„Ç£„Çπ103_ÁÖßÂ∫¶„Çª„É≥„Çµ„Éº', type: 'illuminance', equipmentId: 'Room_103', unit: 'lx' }
                    ]
                };
                setBuildingData(sample);
                alert('„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü');
            };

            // JSON„Ç®„ÇØ„Çπ„Éù„Éº„Éà
            const exportJSON = () => {
                const dataStr = JSON.stringify(buildingData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `building_data_${buildingData.building.id}.json`;
                link.click();
            };

            // JSON„Ç§„É≥„Éù„Éº„Éà
            const importJSON = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            setBuildingData(data);
                            alert('JSON„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü');
                        } catch (error) {
                            alert('JSON„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                        }
                    };
                    reader.readAsText(file);
                }
            };

            // CSV„Ç§„É≥„Éù„Éº„ÉàÔºàÂÖ∑‰Ωì„Çª„É≥„Çµ„ÉºÔºâ
            const importPhysicalSensorsCSV = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const text = e.target.result;
                        const lines = text.split(/\r?\n/).filter(line => line.trim());
                        const headers = lines[0].split(',');
                        const sensors = lines.slice(1).map(line => {
                            const values = line.split(',');
                            return {
                                id: values[0]?.trim(),
                                name: values[1]?.trim(),
                                type: values[2]?.trim(),
                                location: values[3]?.trim(),
                                unit: values[4]?.trim()
                            };
                        }).filter(s => s.id);
                        setPhysicalSensors(sensors);
                        alert(`${sensors.length}ÂÄã„ÅÆÂÖ∑‰Ωì„Çª„É≥„Çµ„Éº„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`);
                    };
                    reader.readAsText(file);
                }
            };

            // AI „Çª„É≥„Çµ„Éº„Éû„ÉÉ„Éî„É≥„Ç∞Ôºà„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Ôºâ
            const performSensorMapping = () => {
                if (!apiKey) {
                    alert('APIË®≠ÂÆö„ÅßAPI„Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (physicalSensors.length === 0) {
                    alert('ÂÖ∑‰Ωì„Çª„É≥„Çµ„ÉºCSV„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (buildingData.sensors.length === 0) {
                    alert('Âª∫Áâ©„Ç®„Éá„Ç£„Çø„Åß„Çª„É≥„Çµ„Éº„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                // AI„Éû„ÉÉ„Éî„É≥„Ç∞„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÔºàÂÆüÈöõ„ÅÆAIÂÆüË£Ö„Åß„ÅØ„ÄÅAPI„ÇíÂëº„Å≥Âá∫„ÅôÔºâ
                const mappings = [];
                buildingData.sensors.forEach(genSensor => {
                    // Á∞°ÊòìÁöÑ„Å™„Éû„ÉÉ„ÉÅ„É≥„Ç∞„É≠„Ç∏„ÉÉ„ÇØÔºà„Çø„Ç§„Éó„Å®ÂêçÂâç„ÅÆÈ°û‰ººÊÄßÔºâ
                    physicalSensors.forEach(physSensor => {
                        if (genSensor.type === physSensor.type) {
                            const confidence = calculateSimilarity(genSensor.name, physSensor.name);
                            if (confidence > 0.5) {
                                mappings.push({
                                    generatedSensorId: genSensor.id,
                                    generatedSensorName: genSensor.name,
                                    physicalSensorId: physSensor.id,
                                    physicalSensorName: physSensor.name,
                                    confidence: confidence,
                                    reason: `„Çø„Ç§„Éó‰∏ÄËá¥: ${genSensor.type}, ÂêçÂâçÈ°û‰ººÂ∫¶: ${(confidence * 100).toFixed(0)}%`
                                });
                            }
                        }
                    });
                });

                // ÂêÑÁîüÊàê„Çª„É≥„Çµ„Éº„Å´ÂØæ„Åó„Å¶ÊúÄ„ÇÇ‰ø°È†ºÂ∫¶„ÅÆÈ´ò„ÅÑ„Éû„ÉÉ„Éî„É≥„Ç∞„ÅÆ„Åø„ÇíÊÆã„Åô
                const bestMappings = {};
                mappings.forEach(mapping => {
                    const key = mapping.generatedSensorId;
                    if (!bestMappings[key] || bestMappings[key].confidence < mapping.confidence) {
                        bestMappings[key] = mapping;
                    }
                });

                setSensorMappings(Object.values(bestMappings));
                alert(`${Object.keys(bestMappings).length}ÂÄã„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞„ÇíÁîüÊàê„Åó„Åæ„Åó„Åü`);
            };

            // Á∞°ÊòìÁöÑ„Å™ÊñáÂ≠óÂàóÈ°û‰ººÂ∫¶Ë®àÁÆó
            const calculateSimilarity = (str1, str2) => {
                const longer = str1.length > str2.length ? str1 : str2;
                const shorter = str1.length > str2.length ? str2 : str1;

                if (longer.length === 0) return 1.0;

                let matches = 0;
                for (let i = 0; i < shorter.length; i++) {
                    if (longer.includes(shorter[i])) matches++;
                }

                return matches / longer.length;
            };

            // „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„ÉºÁµåÁî±„ÅßAI APIÂëº„Å≥Âá∫„Åó
            const callActualAPI = async (prompt, provider, model, endpoint, key) => {
                try {
                    // „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„Éº„ÅÆURLÔºà„Éá„Éï„Ç©„É´„Éà„ÅØlocalhost:3001Ôºâ
                    const backendURL = window.location.origin;
                    const proxyEndpoint = `${backendURL}/api/${provider}`;

                    console.log(`Calling backend proxy: ${proxyEndpoint}`);

                    const response = await fetch(proxyEndpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            apiKey: key,
                            model: model,
                            prompt: prompt,
                            endpoint: endpoint || undefined
                        })
                    });

                    const data = await response.json();

                    if (!response.ok || !data.success) {
                        throw new Error(data.error || data.message || 'API Error');
                    }

                    return data.content;
                } catch (error) {
                    // „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÇÑ„Çµ„Éº„Éê„ÉºÊé•Á∂ö„Ç®„É©„Éº„ÅÆË©≥Á¥∞Ë°®Á§∫
                    if (error.message.includes('Failed to fetch')) {
                        throw new Error('„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Çµ„Éº„Éê„Éº„ÅåËµ∑Âãï„Åó„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ(http://localhost:3001)');
                    }
                    throw error;
                }
            };

            // „ÉÅ„É£„ÉÉ„ÉàÈÄÅ‰ø°
            const sendChatMessage = async (message) => {
                if (!message.trim()) return;

                // „É¶„Éº„Ç∂„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÇíËøΩÂä†
                const userMessage = { role: 'user', content: message };
                setChatMessages(prev => [...prev, userMessage]);

                // „Éó„É≠„É≥„Éó„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà„Å´Â§âÊï∞„ÇíÂüã„ÇÅËæº„Çì„ÅßÂÆüÈöõ„ÅÆ„Éó„É≠„É≥„Éó„Éà„ÇíÁîüÊàê
                const actualPrompt = queryPromptTemplate
                    .replace('{buildingData}', JSON.stringify(buildingData, null, 2))
                    .replace('{sensorMappings}', JSON.stringify(sensorMappings, null, 2))
                    .replace('{query}', message);

                const isAPIMode = !!apiKey;
                const actualEndpoint = apiEndpoint || getDefaultEndpoint(apiProvider);

                // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÇíÊ∫ñÂÇô
                const debugInfo = {
                    timestamp: new Date().toISOString(),
                    provider: apiProvider,
                    model: apiModel,
                    endpoint: actualEndpoint,
                    hasApiKey: isAPIMode,
                    promptTemplate: queryPromptTemplate,
                    actualPrompt: actualPrompt,
                    buildingDataSize: JSON.stringify(buildingData).length,
                    sensorMappingsCount: sensorMappings.length,
                    mode: isAPIMode ? 'API Mode (ÂÆüÈöõ„ÅÆAI API‰ΩøÁî®)' : 'Simulation Mode („ÉÄ„Éü„ÉºÂøúÁ≠î)'
                };

                // AI„É¨„Çπ„Éù„É≥„ÇπÂèñÂæó
                if (isAPIMode) {
                    // ÂÆüÈöõ„ÅÆAPIÂëº„Å≥Âá∫„Åó
                    try {
                        const response = await callActualAPI(actualPrompt, apiProvider, apiModel, actualEndpoint, apiKey);

                        // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Å´„É¨„Çπ„Éù„É≥„Çπ„ÇíËøΩÂä†
                        const debugInfoWithResponse = {
                            ...debugInfo,
                            rawResponse: response,
                            responseLength: response.length,
                            responseTime: new Date().toISOString(),
                            apiCallSuccess: true
                        };

                        const assistantMessage = {
                            role: 'assistant',
                            content: response,
                            debug: debugInfoWithResponse
                        };
                        setChatMessages(prev => [...prev, assistantMessage]);
                    } catch (error) {
                        // API„Ç®„É©„ÉºÊôÇ
                        let errorMessage = `‚ùå APIÂëº„Å≥Âá∫„Åó„Ç®„É©„Éº: ${error.message}\n\n`;
                        let isServerError = false;

                        // „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„ÉºÊé•Á∂ö„Ç®„É©„Éº„ÅÆÊ§úÂá∫
                        if (error.message.includes('„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì')) {
                            isServerError = true;
                            errorMessage += `üîå „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„Éº„ÅåËµ∑Âãï„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\n\n`;
                            errorMessage += `Ëß£Ê±∫ÊñπÊ≥ï:\n`;
                            errorMessage += `1. „Çø„Éº„Éü„Éä„É´„ÇíÈñã„Åè\n`;
                            errorMessage += `2. workbench„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´ÁßªÂãï: cd workbench\n`;
                            errorMessage += `3. npm install „Åß‰æùÂ≠ò„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Ç§„É≥„Çπ„Éà„Éº„É´ÔºàÂàùÂõû„ÅÆ„ÅøÔºâ\n`;
                            errorMessage += `4. npm start „Åß„Çµ„Éº„Éê„Éº„ÇíËµ∑Âãï\n`;
                            errorMessage += `5. http://localhost:3001/building_model_workbench.html „Åß„Ç¢„ÇØ„Çª„Çπ\n\n`;
                            errorMessage += `Ë©≥Á¥∞„ÅØ README_SERVER.md „ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n`;
                        } else {
                            errorMessage += `„Éó„É≠„Éê„Ç§„ÉÄ„Éº: ${apiProvider}\n`;
                            errorMessage += `„É¢„Éá„É´: ${apiModel}\n`;
                            errorMessage += `„Éê„ÉÉ„ÇØ„Ç®„É≥„ÉâURL: ${window.location.origin}/api/${apiProvider}\n\n`;
                            errorMessage += `ËÄÉ„Åà„Çâ„Çå„ÇãÂéüÂõ†:\n`;
                            errorMessage += `- API„Ç≠„Éº„ÅåÊ≠£„Åó„Åè„Å™„ÅÑ\n`;
                            errorMessage += `- „É¢„Éá„É´Âêç„ÅåÊ≠£„Åó„Åè„Å™„ÅÑ\n`;
                            errorMessage += `- APIÂà©Áî®Âà∂Èôê„Å´ÈÅî„Åó„Å¶„ÅÑ„Çã\n`;
                            errorMessage += `- „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂ö„ÅÆÂïèÈ°å\n`;
                        }

                        const debugInfoWithError = {
                            ...debugInfo,
                            rawResponse: errorMessage,
                            responseLength: errorMessage.length,
                            responseTime: new Date().toISOString(),
                            apiCallSuccess: false,
                            errorMessage: error.message,
                            isServerError: isServerError,
                            errorType: error.name
                        };

                        const assistantMessage = {
                            role: 'assistant',
                            content: errorMessage,
                            debug: debugInfoWithError
                        };
                        setChatMessages(prev => [...prev, assistantMessage]);
                    }
                } else {
                    // „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„É¢„Éº„Éâ
                    setTimeout(() => {
                        const response = generateAIResponse(message, buildingData, sensorMappings);

                        const debugInfoWithResponse = {
                            ...debugInfo,
                            rawResponse: response,
                            responseLength: response.length,
                            responseTime: new Date().toISOString(),
                            apiCallSuccess: false,
                            simulationNote: 'API„Ç≠„Éº„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åü„ÇÅ„ÉÄ„Éü„ÉºÂøúÁ≠î„ÇíËøî„Åó„Å¶„ÅÑ„Åæ„Åô'
                        };

                        const assistantMessage = {
                            role: 'assistant',
                            content: response,
                            debug: debugInfoWithResponse
                        };
                        setChatMessages(prev => [...prev, assistantMessage]);
                    }, 500);
                }
            };

            // „Éá„Éï„Ç©„É´„Éà„Ç®„É≥„Éâ„Éù„Ç§„É≥„ÉàÂèñÂæóÈñ¢Êï∞
            const getDefaultEndpoint = (provider) => {
                switch (provider) {
                    case 'openai':
                        return 'https://api.openai.com/v1';
                    case 'anthropic':
                        return 'https://api.anthropic.com/v1';
                    case 'google':
                        return 'https://generativelanguage.googleapis.com/v1';
                    default:
                        return '';
                }
            };

            // AIÂøúÁ≠îÁîüÊàêÔºà„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Ôºâ
            const generateAIResponse = (query, data, mappings) => {
                const lowerQuery = query.toLowerCase();

                // Ê∏©Â∫¶„Çª„É≥„Çµ„Éº„ÅÆÊ§úÁ¥¢
                if (lowerQuery.includes('Ê∏©Â∫¶') || lowerQuery.includes('Ê∞óÊ∏©')) {
                    const tempSensors = data.sensors.filter(s => s.type === 'temperature');
                    if (tempSensors.length > 0) {
                        let response = `${tempSensors.length}ÂÄã„ÅÆÊ∏©Â∫¶„Çª„É≥„Çµ„Éº„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü:\\n\\n`;
                        tempSensors.forEach(sensor => {
                            response += `- ${sensor.name} (ID: ${sensor.id})\\n`;
                            const mapping = mappings.find(m => m.generatedSensorId === sensor.id);
                            if (mapping) {
                                response += `  ‚Üí ÂÖ∑‰Ωì„Çª„É≥„Çµ„Éº: ${mapping.physicalSensorName} (‰ø°È†ºÂ∫¶: ${(mapping.confidence * 100).toFixed(0)}%)\\n`;
                            }
                        });
                        return response;
                    }
                }

                // ‰ºöË≠∞ÂÆ§„ÅÆÊ§úÁ¥¢
                if (lowerQuery.includes('‰ºöË≠∞ÂÆ§')) {
                    const meetingRooms = data.rooms.filter(r => r.name.includes('‰ºöË≠∞ÂÆ§'));
                    if (meetingRooms.length > 0) {
                        let response = `${meetingRooms.length}ÂÄã„ÅÆ‰ºöË≠∞ÂÆ§„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü:\\n\\n`;
                        meetingRooms.forEach(room => {
                            response += `- ${room.name} (ID: ${room.id})\\n`;
                            const roomSensors = data.sensors.filter(s => s.equipmentId === room.id);
                            if (roomSensors.length > 0) {
                                response += `  „Çª„É≥„Çµ„Éº: ${roomSensors.map(s => s.name).join(', ')}\\n`;
                            }
                        });
                        return response;
                    }
                }

                // „Éá„Éï„Ç©„É´„Éà„É¨„Çπ„Éù„É≥„Çπ
                return `Áî≥„ÅóË®≥„Åî„Åñ„ÅÑ„Åæ„Åõ„Çì„ÄÇ„Äå${query}„Äç„Å´Èñ¢„Åô„ÇãÊÉÖÂ†±„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ\\n\\n‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™Ë≥™Âïè„Çí„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ:\\n- „Äå‰ºöË≠∞ÂÆ§„ÅÆÊ∏©Â∫¶„Çª„É≥„Çµ„Éº„ÇíÊïô„Åà„Å¶„Äç\\n- „Äå1Èöé„ÅÆ„Çª„É≥„Çµ„Éº‰∏ÄË¶ß„Äç\\n- „ÄåÂ§ñË™øÊ©ü„ÅÆ„Çª„É≥„Çµ„Éº„Äç`;
            };

            // „Éì„É•„Éº„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
            const renderView = () => {
                switch (currentView) {
                    case 'editor':
                        return <BuildingEditor data={buildingData} setData={setBuildingData} />;
                    case 'mapping':
                        return <SensorMapping
                            generatedSensors={buildingData.sensors}
                            physicalSensors={physicalSensors}
                            mappings={sensorMappings}
                            onImportCSV={importPhysicalSensorsCSV}
                            onPerformMapping={performSensorMapping}
                        />;
                    case 'chat':
                        return <ChatInterface
                            messages={chatMessages}
                            onSendMessage={sendChatMessage}
                            promptTemplate={queryPromptTemplate}
                            setPromptTemplate={setQueryPromptTemplate}
                            buildingData={buildingData}
                            sensorMappings={sensorMappings}
                        />;
                    case 'settings':
                        return <Settings
                            apiKey={apiKey}
                            setApiKey={setApiKey}
                            apiProvider={apiProvider}
                            setApiProvider={setApiProvider}
                            apiModel={apiModel}
                            setApiModel={setApiModel}
                            apiEndpoint={apiEndpoint}
                            setApiEndpoint={setApiEndpoint}
                        />;
                    default:
                        return <div>Êú™ÂÆüË£Ö</div>;
                }
            };

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>Âª∫Áâ©„É¢„Éá„É´„ÉØ„Éº„ÇØ„Éô„É≥„ÉÅ</h1>
                        <p>Building Model Workbench - Áµ±ÂêàÂª∫Áâ©ÊÉÖÂ†±ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</p>
                    </div>

                    <div className="main-content">
                        <div className="sidebar">
                            <div className="sidebar-section">
                                <h3>„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥</h3>
                                <button
                                    className={`nav-button ${currentView === 'editor' ? 'active' : ''}`}
                                    onClick={() => setCurrentView('editor')}
                                >
                                    üìù Âª∫Áâ©„É¢„Éá„É´„Ç®„Éá„Ç£„Çø
                                </button>
                                <button
                                    className={`nav-button ${currentView === 'mapping' ? 'active' : ''}`}
                                    onClick={() => setCurrentView('mapping')}
                                >
                                    üîó „Çª„É≥„Çµ„Éº„Éû„ÉÉ„Éî„É≥„Ç∞
                                </button>
                                <button
                                    className={`nav-button ${currentView === 'chat' ? 'active' : ''}`}
                                    onClick={() => setCurrentView('chat')}
                                >
                                    üí¨ Ëá™ÁÑ∂Ë®ÄË™û„ÇØ„Ç®„É™
                                </button>
                                <button
                                    className={`nav-button ${currentView === 'settings' ? 'active' : ''}`}
                                    onClick={() => setCurrentView('settings')}
                                >
                                    ‚öôÔ∏è APIË®≠ÂÆö
                                </button>
                            </div>

                            <div className="sidebar-section">
                                <h3>„Éá„Éº„ÇøÁÆ°ÁêÜ</h3>
                                <button className="nav-button" onClick={loadSampleData}>
                                    üìã „Çµ„É≥„Éó„É´„Éá„Éº„ÇøË™≠Ëæº
                                </button>
                                <button className="nav-button" onClick={exportJSON}>
                                    üíæ JSON„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                                </button>
                                <label className="nav-button" style={{cursor: 'pointer'}}>
                                    üìÇ JSON„Ç§„É≥„Éù„Éº„Éà
                                    <input type="file" accept=".json" onChange={importJSON} />
                                </label>
                            </div>

                            <div className="sidebar-section" style={{marginTop: 'auto'}}>
                                <div className="stats-grid" style={{gridTemplateColumns: '1fr'}}>
                                    <div className="stat-card">
                                        <h3>„Çª„É≥„Çµ„ÉºÊï∞</h3>
                                        <div className="value">{buildingData.sensors.length}</div>
                                    </div>
                                    <div className="stat-card">
                                        <h3>„Éû„ÉÉ„Éî„É≥„Ç∞Êï∞</h3>
                                        <div className="value">{sensorMappings.length}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="workspace">
                            {renderView()}
                        </div>
                    </div>
                </div>
            );
        };

        // Âª∫Áâ©„Ç®„Éá„Ç£„Çø„Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÔºàÂÖ®Ê©üËÉΩÔºâ
        const BuildingEditor = ({ data, setData }) => {
            const [activeTab, setActiveTab] = useState('building');

            // Âª∫Áâ©ÊÉÖÂ†±„ÅÆÊõ¥Êñ∞
            const updateBuilding = (field, value) => {
                setData(prev => ({
                    ...prev,
                    building: { ...prev.building, [field]: value }
                }));
            };

            // Èöé„ÅÆÊìç‰Ωú
            const addFloor = () => {
                setData(prev => ({
                    ...prev,
                    floors: [...prev.floors, { id: '', name: '', area: 0 }]
                }));
            };

            const updateFloor = (index, field, value) => {
                setData(prev => ({
                    ...prev,
                    floors: prev.floors.map((floor, i) =>
                        i === index ? { ...floor, [field]: value } : floor
                    )
                }));
            };

            const deleteFloor = (index) => {
                setData(prev => ({
                    ...prev,
                    floors: prev.floors.filter((_, i) => i !== index)
                }));
            };

            // Â§ß„Çæ„Éº„É≥„ÅÆÊìç‰Ωú
            const addLargeZone = () => {
                setData(prev => ({
                    ...prev,
                    largeZones: [...prev.largeZones, { id: '', name: '', floorId: '', ahuId: '' }]
                }));
            };

            const updateLargeZone = (index, field, value) => {
                setData(prev => ({
                    ...prev,
                    largeZones: prev.largeZones.map((zone, i) =>
                        i === index ? { ...zone, [field]: value } : zone
                    )
                }));
            };

            const deleteLargeZone = (index) => {
                setData(prev => ({
                    ...prev,
                    largeZones: prev.largeZones.filter((_, i) => i !== index)
                }));
            };

            // Â∞è„Çæ„Éº„É≥„ÅÆÊìç‰Ωú
            const addSmallZone = () => {
                setData(prev => ({
                    ...prev,
                    smallZones: [...prev.smallZones, { id: '', name: '', largeZoneId: '', vrfId: '' }]
                }));
            };

            const updateSmallZone = (index, field, value) => {
                setData(prev => ({
                    ...prev,
                    smallZones: prev.smallZones.map((zone, i) =>
                        i === index ? { ...zone, [field]: value } : zone
                    )
                }));
            };

            const deleteSmallZone = (index) => {
                setData(prev => ({
                    ...prev,
                    smallZones: prev.smallZones.filter((_, i) => i !== index)
                }));
            };

            // ÈÉ®Â±ã„ÅÆÊìç‰Ωú
            const addRoom = () => {
                setData(prev => ({
                    ...prev,
                    rooms: [...prev.rooms, { id: '', name: '', smallZoneId: '', area: 0 }]
                }));
            };

            const updateRoom = (index, field, value) => {
                setData(prev => ({
                    ...prev,
                    rooms: prev.rooms.map((room, i) =>
                        i === index ? { ...room, [field]: value } : room
                    )
                }));
            };

            const deleteRoom = (index) => {
                setData(prev => ({
                    ...prev,
                    rooms: prev.rooms.filter((_, i) => i !== index)
                }));
            };

            // „ÉÅ„É©„Éº„ÅÆÊìç‰Ωú
            const addChiller = () => {
                setData(prev => ({
                    ...prev,
                    centralHVAC: {
                        ...prev.centralHVAC,
                        chillers: [...prev.centralHVAC.chillers, { id: '', name: '', capacity: 0, powerRating: 0 }]
                    }
                }));
            };

            const updateChiller = (index, field, value) => {
                setData(prev => ({
                    ...prev,
                    centralHVAC: {
                        ...prev.centralHVAC,
                        chillers: prev.centralHVAC.chillers.map((chiller, i) =>
                            i === index ? { ...chiller, [field]: value } : chiller
                        )
                    }
                }));
            };

            const deleteChiller = (index) => {
                setData(prev => ({
                    ...prev,
                    centralHVAC: {
                        ...prev.centralHVAC,
                        chillers: prev.centralHVAC.chillers.filter((_, i) => i !== index)
                    }
                }));
            };

            // AHU„ÅÆÊìç‰Ωú
            const addAHU = () => {
                setData(prev => ({
                    ...prev,
                    centralHVAC: {
                        ...prev.centralHVAC,
                        ahus: [...prev.centralHVAC.ahus, { id: '', name: '', chillerId: '', airflow: 0 }]
                    }
                }));
            };

            const updateAHU = (index, field, value) => {
                setData(prev => ({
                    ...prev,
                    centralHVAC: {
                        ...prev.centralHVAC,
                        ahus: prev.centralHVAC.ahus.map((ahu, i) =>
                            i === index ? { ...ahu, [field]: value } : ahu
                        )
                    }
                }));
            };

            const deleteAHU = (index) => {
                setData(prev => ({
                    ...prev,
                    centralHVAC: {
                        ...prev.centralHVAC,
                        ahus: prev.centralHVAC.ahus.filter((_, i) => i !== index)
                    }
                }));
            };

            // VAV„ÅÆÊìç‰Ωú
            const addVAV = () => {
                setData(prev => ({
                    ...prev,
                    centralHVAC: {
                        ...prev.centralHVAC,
                        vavs: [...prev.centralHVAC.vavs, { id: '', name: '', ahuId: '', largeZoneId: '' }]
                    }
                }));
            };

            const updateVAV = (index, field, value) => {
                setData(prev => ({
                    ...prev,
                    centralHVAC: {
                        ...prev.centralHVAC,
                        vavs: prev.centralHVAC.vavs.map((vav, i) =>
                            i === index ? { ...vav, [field]: value } : vav
                        )
                    }
                }));
            };

            const deleteVAV = (index) => {
                setData(prev => ({
                    ...prev,
                    centralHVAC: {
                        ...prev.centralHVAC,
                        vavs: prev.centralHVAC.vavs.filter((_, i) => i !== index)
                    }
                }));
            };

            // VRF„ÅÆÊìç‰Ωú
            const addVRF = () => {
                setData(prev => ({
                    ...prev,
                    individualHVAC: {
                        ...prev.individualHVAC,
                        vrfs: [...prev.individualHVAC.vrfs, { id: '', name: '', capacity: 0, powerRating: 0 }]
                    }
                }));
            };

            const updateVRF = (index, field, value) => {
                setData(prev => ({
                    ...prev,
                    individualHVAC: {
                        ...prev.individualHVAC,
                        vrfs: prev.individualHVAC.vrfs.map((vrf, i) =>
                            i === index ? { ...vrf, [field]: value } : vrf
                        )
                    }
                }));
            };

            const deleteVRF = (index) => {
                setData(prev => ({
                    ...prev,
                    individualHVAC: {
                        ...prev.individualHVAC,
                        vrfs: prev.individualHVAC.vrfs.filter((_, i) => i !== index)
                    }
                }));
            };

            // „Çª„É≥„Çµ„Éº„ÅÆÊìç‰Ωú
            const addSensor = () => {
                setData(prev => ({
                    ...prev,
                    sensors: [...prev.sensors, { id: '', name: '', type: 'temperature', equipmentId: '', unit: '¬∞C' }]
                }));
            };

            const updateSensor = (index, field, value) => {
                setData(prev => ({
                    ...prev,
                    sensors: prev.sensors.map((sensor, i) =>
                        i === index ? { ...sensor, [field]: value } : sensor
                    )
                }));
            };

            const deleteSensor = (index) => {
                setData(prev => ({
                    ...prev,
                    sensors: prev.sensors.filter((_, i) => i !== index)
                }));
            };

            const renderTabContent = () => {
                switch (activeTab) {
                    case 'building':
                        return (
                            <div className="card">
                                <h2>Âª∫Áâ©Âü∫Êú¨ÊÉÖÂ†±</h2>
                                <div className="form-group">
                                    <label>Âª∫Áâ©ID</label>
                                    <input
                                        value={data.building.id}
                                        onChange={(e) => updateBuilding('id', e.target.value)}
                                        placeholder="Building_A"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Âª∫Áâ©Âêç</label>
                                    <input
                                        value={data.building.name}
                                        onChange={(e) => updateBuilding('name', e.target.value)}
                                        placeholder="Êù±‰∫¨„Ç∞„É™„Éº„É≥„Çø„ÉØ„Éº"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>ÊâÄÂú®Âú∞</label>
                                    <input
                                        value={data.building.location}
                                        onChange={(e) => updateBuilding('location', e.target.value)}
                                        placeholder="Êù±‰∫¨ÈÉΩÂçÉ‰ª£Áî∞Âå∫"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Âª∂Â∫äÈù¢Á©çÔºà„é°Ôºâ</label>
                                    <input
                                        type="number"
                                        value={data.building.totalArea}
                                        onChange={(e) => updateBuilding('totalArea', parseFloat(e.target.value) || 0)}
                                    />
                                </div>
                            </div>
                        );

                    case 'floors':
                        return (
                            <div className="card">
                                <h2>ÈöéÔºà{data.floors.length}Ôºâ</h2>
                                <button className="btn btn-primary" onClick={addFloor}>Èöé„ÇíËøΩÂä†</button>
                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>ÂêçÁß∞</th>
                                                <th>Èù¢Á©çÔºà„é°Ôºâ</th>
                                                <th>Êìç‰Ωú</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {data.floors.map((floor, index) => (
                                                <tr key={index}>
                                                    <td>
                                                        <input
                                                            value={floor.id}
                                                            onChange={(e) => updateFloor(index, 'id', e.target.value)}
                                                            placeholder="Floor_1"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input
                                                            value={floor.name}
                                                            onChange={(e) => updateFloor(index, 'name', e.target.value)}
                                                            placeholder="1Èöé"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input
                                                            type="number"
                                                            value={floor.area}
                                                            onChange={(e) => updateFloor(index, 'area', parseFloat(e.target.value) || 0)}
                                                        />
                                                    </td>
                                                    <td>
                                                        <button className="delete-btn" onClick={() => deleteFloor(index)}>ÂâäÈô§</button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        );

                    case 'zones':
                        return (
                            <div>
                                <div className="card">
                                    <h2>Â§ß„Çæ„Éº„É≥ÔºàÂÖ®È§®Á©∫Ë™øÊãÖÂΩìÔºâÔºà{data.largeZones.length}Ôºâ</h2>
                                    <button className="btn btn-primary" onClick={addLargeZone}>Â§ß„Çæ„Éº„É≥ËøΩÂä†</button>
                                    <div className="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>ÂêçÁß∞</th>
                                                    <th>Èöé</th>
                                                    <th>AHU</th>
                                                    <th>Êìç‰Ωú</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {data.largeZones.map((zone, index) => (
                                                    <tr key={index}>
                                                        <td>
                                                            <input
                                                                value={zone.id}
                                                                onChange={(e) => updateLargeZone(index, 'id', e.target.value)}
                                                                placeholder="LargeZone_1A"
                                                            />
                                                        </td>
                                                        <td>
                                                            <input
                                                                value={zone.name}
                                                                onChange={(e) => updateLargeZone(index, 'name', e.target.value)}
                                                                placeholder="Â§ß„Çæ„Éº„É≥1A(Êù±ÂÅ¥„Ç®„É™„Ç¢)"
                                                            />
                                                        </td>
                                                        <td>
                                                            <select
                                                                value={zone.floorId}
                                                                onChange={(e) => updateLargeZone(index, 'floorId', e.target.value)}
                                                            >
                                                                <option value="">Èöé„ÇíÈÅ∏Êäû</option>
                                                                {data.floors.map(f => (
                                                                    <option key={f.id} value={f.id}>{f.name}</option>
                                                                ))}
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <select
                                                                value={zone.ahuId}
                                                                onChange={(e) => updateLargeZone(index, 'ahuId', e.target.value)}
                                                            >
                                                                <option value="">AHU„ÇíÈÅ∏Êäû</option>
                                                                {data.centralHVAC.ahus.map(a => (
                                                                    <option key={a.id} value={a.id}>{a.name}</option>
                                                                ))}
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <button className="delete-btn" onClick={() => deleteLargeZone(index)}>ÂâäÈô§</button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div className="card" style={{marginTop: '20px'}}>
                                    <h2>Â∞è„Çæ„Éº„É≥ÔºàÂÄãÂà•Á©∫Ë™øÊãÖÂΩìÔºâÔºà{data.smallZones.length}Ôºâ</h2>
                                    <button className="btn btn-success" onClick={addSmallZone}>Â∞è„Çæ„Éº„É≥ËøΩÂä†</button>
                                    <div className="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>ÂêçÁß∞</th>
                                                    <th>Â§ß„Çæ„Éº„É≥</th>
                                                    <th>VRF</th>
                                                    <th>Êìç‰Ωú</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {data.smallZones.map((zone, index) => (
                                                    <tr key={index}>
                                                        <td>
                                                            <input
                                                                value={zone.id}
                                                                onChange={(e) => updateSmallZone(index, 'id', e.target.value)}
                                                                placeholder="SmallZone_1A1"
                                                            />
                                                        </td>
                                                        <td>
                                                            <input
                                                                value={zone.name}
                                                                onChange={(e) => updateSmallZone(index, 'name', e.target.value)}
                                                                placeholder="Â∞è„Çæ„Éº„É≥1A1(‰ºöË≠∞ÂÆ§„Ç®„É™„Ç¢)"
                                                            />
                                                        </td>
                                                        <td>
                                                            <select
                                                                value={zone.largeZoneId}
                                                                onChange={(e) => updateSmallZone(index, 'largeZoneId', e.target.value)}
                                                            >
                                                                <option value="">Â§ß„Çæ„Éº„É≥„ÇíÈÅ∏Êäû</option>
                                                                {data.largeZones.map(lz => (
                                                                    <option key={lz.id} value={lz.id}>{lz.name}</option>
                                                                ))}
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <select
                                                                value={zone.vrfId}
                                                                onChange={(e) => updateSmallZone(index, 'vrfId', e.target.value)}
                                                            >
                                                                <option value="">VRF„ÇíÈÅ∏Êäû</option>
                                                                {data.individualHVAC.vrfs.map(v => (
                                                                    <option key={v.id} value={v.id}>{v.name}</option>
                                                                ))}
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <button className="delete-btn" onClick={() => deleteSmallZone(index)}>ÂâäÈô§</button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        );

                    case 'rooms':
                        return (
                            <div className="card">
                                <h2>ÈÉ®Â±ãÔºà{data.rooms.length}Ôºâ</h2>
                                <button className="btn btn-primary" onClick={addRoom}>ÈÉ®Â±ã„ÇíËøΩÂä†</button>
                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>ÂêçÁß∞</th>
                                                <th>Â∞è„Çæ„Éº„É≥</th>
                                                <th>Èù¢Á©çÔºà„é°Ôºâ</th>
                                                <th>Êìç‰Ωú</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {data.rooms.map((room, index) => (
                                                <tr key={index}>
                                                    <td>
                                                        <input
                                                            value={room.id}
                                                            onChange={(e) => updateRoom(index, 'id', e.target.value)}
                                                            placeholder="Room_101"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input
                                                            value={room.name}
                                                            onChange={(e) => updateRoom(index, 'name', e.target.value)}
                                                            placeholder="‰ºöË≠∞ÂÆ§101"
                                                        />
                                                    </td>
                                                    <td>
                                                        <select
                                                            value={room.smallZoneId}
                                                            onChange={(e) => updateRoom(index, 'smallZoneId', e.target.value)}
                                                        >
                                                            <option value="">Â∞è„Çæ„Éº„É≥„ÇíÈÅ∏Êäû</option>
                                                            {data.smallZones.map(sz => (
                                                                <option key={sz.id} value={sz.id}>{sz.name}</option>
                                                            ))}
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input
                                                            type="number"
                                                            value={room.area}
                                                            onChange={(e) => updateRoom(index, 'area', parseFloat(e.target.value) || 0)}
                                                        />
                                                    </td>
                                                    <td>
                                                        <button className="delete-btn" onClick={() => deleteRoom(index)}>ÂâäÈô§</button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        );

                    case 'central':
                        return (
                            <div>
                                <div className="card">
                                    <h2>„ÉÅ„É©„ÉºÔºà{data.centralHVAC.chillers.length}Ôºâ</h2>
                                    <button className="btn btn-primary" onClick={addChiller}>„ÉÅ„É©„ÉºËøΩÂä†</button>
                                    <div className="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>ÂêçÁß∞</th>
                                                    <th>ÂÆπÈáèÔºàkWÔºâ</th>
                                                    <th>ÂÆöÊ†ºÈõªÂäõÔºàkWÔºâ</th>
                                                    <th>Êìç‰Ωú</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {data.centralHVAC.chillers.map((chiller, index) => (
                                                    <tr key={index}>
                                                        <td>
                                                            <input
                                                                value={chiller.id}
                                                                onChange={(e) => updateChiller(index, 'id', e.target.value)}
                                                                placeholder="Chiller_1"
                                                            />
                                                        </td>
                                                        <td>
                                                            <input
                                                                value={chiller.name}
                                                                onChange={(e) => updateChiller(index, 'name', e.target.value)}
                                                                placeholder="„ÉÅ„É©„Éº1Âè∑Ê©ü"
                                                            />
                                                        </td>
                                                        <td>
                                                            <input
                                                                type="number"
                                                                value={chiller.capacity}
                                                                onChange={(e) => updateChiller(index, 'capacity', parseFloat(e.target.value) || 0)}
                                                            />
                                                        </td>
                                                        <td>
                                                            <input
                                                                type="number"
                                                                value={chiller.powerRating}
                                                                onChange={(e) => updateChiller(index, 'powerRating', parseFloat(e.target.value) || 0)}
                                                            />
                                                        </td>
                                                        <td>
                                                            <button className="delete-btn" onClick={() => deleteChiller(index)}>ÂâäÈô§</button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div className="card" style={{marginTop: '20px'}}>
                                    <h2>Â§ñË™øÊ©üÔºàAHUÔºâÔºà{data.centralHVAC.ahus.length}Ôºâ</h2>
                                    <button className="btn btn-primary" onClick={addAHU}>AHUËøΩÂä†</button>
                                    <div className="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>ÂêçÁß∞</th>
                                                    <th>„ÉÅ„É©„Éº</th>
                                                    <th>È¢®ÈáèÔºàm¬≥/hÔºâ</th>
                                                    <th>Êìç‰Ωú</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {data.centralHVAC.ahus.map((ahu, index) => (
                                                    <tr key={index}>
                                                        <td>
                                                            <input
                                                                value={ahu.id}
                                                                onChange={(e) => updateAHU(index, 'id', e.target.value)}
                                                                placeholder="AHU_1"
                                                            />
                                                        </td>
                                                        <td>
                                                            <input
                                                                value={ahu.name}
                                                                onChange={(e) => updateAHU(index, 'name', e.target.value)}
                                                                placeholder="Â§ñË™øÊ©ü1Âè∑Ê©ü"
                                                            />
                                                        </td>
                                                        <td>
                                                            <select
                                                                value={ahu.chillerId}
                                                                onChange={(e) => updateAHU(index, 'chillerId', e.target.value)}
                                                            >
                                                                <option value="">„ÉÅ„É©„Éº„ÇíÈÅ∏Êäû</option>
                                                                {data.centralHVAC.chillers.map(c => (
                                                                    <option key={c.id} value={c.id}>{c.name}</option>
                                                                ))}
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <input
                                                                type="number"
                                                                value={ahu.airflow}
                                                                onChange={(e) => updateAHU(index, 'airflow', parseFloat(e.target.value) || 0)}
                                                            />
                                                        </td>
                                                        <td>
                                                            <button className="delete-btn" onClick={() => deleteAHU(index)}>ÂâäÈô§</button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div className="card" style={{marginTop: '20px'}}>
                                    <h2>VAVÔºà{data.centralHVAC.vavs.length}Ôºâ</h2>
                                    <button className="btn btn-primary" onClick={addVAV}>VAVËøΩÂä†</button>
                                    <div className="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>ÂêçÁß∞</th>
                                                    <th>AHU</th>
                                                    <th>Â§ß„Çæ„Éº„É≥</th>
                                                    <th>Êìç‰Ωú</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {data.centralHVAC.vavs.map((vav, index) => (
                                                    <tr key={index}>
                                                        <td>
                                                            <input
                                                                value={vav.id}
                                                                onChange={(e) => updateVAV(index, 'id', e.target.value)}
                                                                placeholder="VAV_1A1"
                                                            />
                                                        </td>
                                                        <td>
                                                            <input
                                                                value={vav.name}
                                                                onChange={(e) => updateVAV(index, 'name', e.target.value)}
                                                                placeholder="VAV 1A-1"
                                                            />
                                                        </td>
                                                        <td>
                                                            <select
                                                                value={vav.ahuId}
                                                                onChange={(e) => updateVAV(index, 'ahuId', e.target.value)}
                                                            >
                                                                <option value="">AHU„ÇíÈÅ∏Êäû</option>
                                                                {data.centralHVAC.ahus.map(a => (
                                                                    <option key={a.id} value={a.id}>{a.name}</option>
                                                                ))}
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <select
                                                                value={vav.largeZoneId}
                                                                onChange={(e) => updateVAV(index, 'largeZoneId', e.target.value)}
                                                            >
                                                                <option value="">Â§ß„Çæ„Éº„É≥„ÇíÈÅ∏Êäû</option>
                                                                {data.largeZones.map(lz => (
                                                                    <option key={lz.id} value={lz.id}>{lz.name}</option>
                                                                ))}
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <button className="delete-btn" onClick={() => deleteVAV(index)}>ÂâäÈô§</button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        );

                    case 'individual':
                        return (
                            <div className="card">
                                <h2>VRFÔºàÂÄãÂà•Á©∫Ë™øÔºâÔºà{data.individualHVAC.vrfs.length}Ôºâ</h2>
                                <button className="btn btn-success" onClick={addVRF}>VRFËøΩÂä†</button>
                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>ÂêçÁß∞</th>
                                                <th>ÂÆπÈáèÔºàkWÔºâ</th>
                                                <th>ÂÆöÊ†ºÈõªÂäõÔºàkWÔºâ</th>
                                                <th>Êìç‰Ωú</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {data.individualHVAC.vrfs.map((vrf, index) => (
                                                <tr key={index}>
                                                    <td>
                                                        <input
                                                            value={vrf.id}
                                                            onChange={(e) => updateVRF(index, 'id', e.target.value)}
                                                            placeholder="VRF_Unit_1"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input
                                                            value={vrf.name}
                                                            onChange={(e) => updateVRF(index, 'name', e.target.value)}
                                                            placeholder="VRFÂÆ§Â§ñÊ©ü1Âè∑Ê©ü"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input
                                                            type="number"
                                                            value={vrf.capacity}
                                                            onChange={(e) => updateVRF(index, 'capacity', parseFloat(e.target.value) || 0)}
                                                        />
                                                    </td>
                                                    <td>
                                                        <input
                                                            type="number"
                                                            value={vrf.powerRating}
                                                            onChange={(e) => updateVRF(index, 'powerRating', parseFloat(e.target.value) || 0)}
                                                        />
                                                    </td>
                                                    <td>
                                                        <button className="delete-btn" onClick={() => deleteVRF(index)}>ÂâäÈô§</button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        );

                    case 'sensors':
                        return (
                            <div className="card">
                                <h2>„Çª„É≥„Çµ„ÉºÔºà{data.sensors.length}Ôºâ</h2>
                                <button className="btn btn-primary" onClick={addSensor}>„Çª„É≥„Çµ„Éº„ÇíËøΩÂä†</button>
                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>ÂêçÁß∞</th>
                                                <th>Á®ÆÈ°û</th>
                                                <th>Ë®≠ÂÇôID</th>
                                                <th>Âçò‰Ωç</th>
                                                <th>Êìç‰Ωú</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {data.sensors.map((sensor, index) => (
                                                <tr key={index}>
                                                    <td>
                                                        <input
                                                            value={sensor.id}
                                                            onChange={(e) => updateSensor(index, 'id', e.target.value)}
                                                            placeholder="Sensor_1"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input
                                                            value={sensor.name}
                                                            onChange={(e) => updateSensor(index, 'name', e.target.value)}
                                                            placeholder="Ê∏©Â∫¶„Çª„É≥„Çµ„Éº"
                                                        />
                                                    </td>
                                                    <td>
                                                        <select
                                                            value={sensor.type}
                                                            onChange={(e) => updateSensor(index, 'type', e.target.value)}
                                                        >
                                                            <option value="temperature">Ê∏©Â∫¶</option>
                                                            <option value="humidity">ÊπøÂ∫¶</option>
                                                            <option value="power">ÈõªÂäõ</option>
                                                            <option value="flow">ÊµÅÈáè</option>
                                                            <option value="position">‰ΩçÁΩÆ</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input
                                                            value={sensor.equipmentId}
                                                            onChange={(e) => updateSensor(index, 'equipmentId', e.target.value)}
                                                            placeholder="AHU_1"
                                                        />
                                                    </td>
                                                    <td>
                                                        <input
                                                            value={sensor.unit}
                                                            onChange={(e) => updateSensor(index, 'unit', e.target.value)}
                                                            placeholder="¬∞C"
                                                        />
                                                    </td>
                                                    <td>
                                                        <button className="delete-btn" onClick={() => deleteSensor(index)}>ÂâäÈô§</button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        );

                    default:
                        return <div>„Çø„Éñ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>;
                }
            };

            return (
                <>
                    <div className="toolbar">
                        <h2 style={{flex: 1, fontSize: '18px'}}>Âª∫Áâ©„É¢„Éá„É´„Ç®„Éá„Ç£„Çø</h2>
                    </div>
                    <div className="content-area">
                        <div className="tab-container">
                            <div className="tabs">
                                <button
                                    className={`tab ${activeTab === 'building' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('building')}
                                >
                                    Âª∫Áâ©ÊÉÖÂ†±
                                </button>
                                <button
                                    className={`tab ${activeTab === 'floors' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('floors')}
                                >
                                    Èöé
                                </button>
                                <button
                                    className={`tab ${activeTab === 'zones' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('zones')}
                                >
                                    „Çæ„Éº„É≥
                                </button>
                                <button
                                    className={`tab ${activeTab === 'rooms' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('rooms')}
                                >
                                    ÈÉ®Â±ã
                                </button>
                                <button
                                    className={`tab ${activeTab === 'central' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('central')}
                                >
                                    ÂÖ®È§®Á©∫Ë™ø
                                </button>
                                <button
                                    className={`tab ${activeTab === 'individual' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('individual')}
                                >
                                    ÂÄãÂà•Á©∫Ë™ø
                                </button>
                                <button
                                    className={`tab ${activeTab === 'sensors' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('sensors')}
                                >
                                    „Çª„É≥„Çµ„Éº
                                </button>
                            </div>
                        </div>
                        {renderTabContent()}
                    </div>
                </>
            );
        };

        // „Çª„É≥„Çµ„Éº„Éû„ÉÉ„Éî„É≥„Ç∞„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
        const SensorMapping = ({ generatedSensors, physicalSensors, mappings, onImportCSV, onPerformMapping }) => {
            return (
                <>
                    <div className="toolbar">
                        <h2 style={{flex: 1, fontSize: '18px'}}>„Çª„É≥„Çµ„Éº„Éû„ÉÉ„Éî„É≥„Ç∞</h2>
                        <label className="btn btn-secondary">
                            ÂÖ∑‰Ωì„Çª„É≥„Çµ„ÉºCSVË™≠Ëæº
                            <input type="file" accept=".csv" onChange={onImportCSV} />
                        </label>
                        <button className="btn btn-primary" onClick={onPerformMapping}>
                            AI„Éû„ÉÉ„Éî„É≥„Ç∞ÂÆüË°å
                        </button>
                    </div>
                    <div className="content-area">
                        <div className="instruction-box">
                            <h3>„Çª„É≥„Çµ„Éº„Éû„ÉÉ„Éî„É≥„Ç∞„Å®„ÅØÔºü</h3>
                            <p>
                                Âª∫Áâ©„Ç®„Éá„Ç£„Çø„ÅßÁîüÊàê„Åó„ÅüË´ñÁêÜÁöÑ„Å™„Çª„É≥„Çµ„ÉºÔºàÁîüÊàê„Çª„É≥„Çµ„ÉºÔºâ„Å®„ÄÅÂÆüÈöõ„Å´Âª∫Áâ©„Å´Ë®≠ÁΩÆ„Åï„Çå„Å¶„ÅÑ„ÇãÁâ©ÁêÜÁöÑ„Å™„Çª„É≥„Çµ„ÉºÔºàÂÖ∑‰Ωì„Çª„É≥„Çµ„ÉºÔºâ„Çí
                                AI„Çí‰Ωø„Å£„Å¶Ëá™ÂãïÁöÑ„Å´„Éû„ÉÉ„Éî„É≥„Ç∞„Åó„Åæ„Åô„ÄÇÂÖ∑‰Ωì„Çª„É≥„Çµ„Éº„ÅÆCSV„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø„ÄÅ„ÄåAI„Éû„ÉÉ„Éî„É≥„Ç∞ÂÆüË°å„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                            </p>
                        </div>

                        <div className="card">
                            <h2>ÁîüÊàê„Çª„É≥„Çµ„Éº‰∏ÄË¶ßÔºàÂª∫Áâ©„Ç®„Éá„Ç£„Çø„Åã„ÇâÔºâ</h2>
                            <div className="sensor-list">
                                {generatedSensors.length === 0 ? (
                                    <p>Âª∫Áâ©„Ç®„Éá„Ç£„Çø„Åß„Çª„É≥„Çµ„Éº„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                ) : (
                                    generatedSensors.map(sensor => (
                                        <div key={sensor.id} className="sensor-item">
                                            <div>
                                                <strong>{sensor.name}</strong>
                                                <div style={{fontSize: '12px', color: '#666'}}>
                                                    ID: {sensor.id} | „Çø„Ç§„Éó: {sensor.type} | Ë®≠ÂÇô: {sensor.equipmentId}
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>

                        <div className="card">
                            <h2>ÂÖ∑‰Ωì„Çª„É≥„Çµ„Éº‰∏ÄË¶ßÔºàCSV„Åã„ÇâË™≠ËæºÔºâ</h2>
                            <div className="sensor-list">
                                {physicalSensors.length === 0 ? (
                                    <p>CSV„Éï„Ç°„Ç§„É´„Åã„ÇâÂÖ∑‰Ωì„Çª„É≥„Çµ„Éº„ÇíË™≠„ÅøËæº„Çì„Åß„Åè„Å†„Åï„ÅÑ</p>
                                ) : (
                                    physicalSensors.map(sensor => (
                                        <div key={sensor.id} className="sensor-item">
                                            <div>
                                                <strong>{sensor.name}</strong>
                                                <div style={{fontSize: '12px', color: '#666'}}>
                                                    ID: {sensor.id} | „Çø„Ç§„Éó: {sensor.type} | Â†¥ÊâÄ: {sensor.location}
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>

                        {mappings.length > 0 && (
                            <div className="card">
                                <h2>„Éû„ÉÉ„Éî„É≥„Ç∞ÁµêÊûú</h2>
                                <div className="mapping-result">
                                    {mappings.map((mapping, index) => (
                                        <div key={index} className="mapping-item">
                                            <div>
                                                <strong>{mapping.generatedSensorName}</strong>
                                                <div style={{fontSize: '12px', color: '#666', marginTop: '4px'}}>
                                                    ‚Üí {mapping.physicalSensorName}
                                                </div>
                                                <div style={{fontSize: '11px', color: '#888', marginTop: '2px'}}>
                                                    {mapping.reason}
                                                </div>
                                            </div>
                                            <span className={`confidence-badge ${
                                                mapping.confidence > 0.8 ? 'confidence-high' :
                                                mapping.confidence > 0.6 ? 'confidence-medium' : 'confidence-low'
                                            }`}>
                                                {(mapping.confidence * 100).toFixed(0)}%
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </>
            );
        };

        // „ÉÅ„É£„ÉÉ„Éà„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
        const ChatInterface = ({ messages, onSendMessage, promptTemplate, setPromptTemplate, buildingData, sensorMappings }) => {
            const [inputMessage, setInputMessage] = useState('');
            const [showPromptEditor, setShowPromptEditor] = useState(false);
            const [showPromptPreview, setShowPromptPreview] = useState(false);
            const [debugMode, setDebugMode] = useState(false);
            const [expandedDebug, setExpandedDebug] = useState({});

            const handleSend = () => {
                if (inputMessage.trim()) {
                    onSendMessage(inputMessage);
                    setInputMessage('');
                }
            };

            const handleResetTemplate = () => {
                if (confirm('„Éó„É≠„É≥„Éó„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí„Éá„Éï„Ç©„É´„Éà„Å´Êàª„Åó„Åæ„Åô„ÅãÔºü')) {
                    setPromptTemplate(`„ÅÇ„Å™„Åü„ÅØÂª∫Áâ©„ÅÆ„Çª„É≥„Çµ„ÉºÊÉÖÂ†±„ÇíÊ§úÁ¥¢„ÉªÂàÜÊûê„Åô„ÇãAI„Ç¢„Ç∑„Çπ„Çø„É≥„Éà„Åß„Åô„ÄÇ

‰ª•‰∏ã„ÅÆÂª∫Áâ©„Éá„Éº„Çø„ÅåÊèê‰æõ„Åï„Çå„Åæ„ÅôÔºö
<building_data>
{buildingData}
</building_data>

‰ª•‰∏ã„ÅÆ„Çª„É≥„Çµ„Éº„Éû„ÉÉ„Éî„É≥„Ç∞ÊÉÖÂ†±„ÅåÊèê‰æõ„Åï„Çå„Åæ„ÅôÔºö
<sensor_mapping>
{sensorMappings}
</sensor_mapping>

„É¶„Éº„Ç∂„Éº„Åã„Çâ„ÅÆË≥™Âïè„Å´Âü∫„Å•„ÅÑ„Å¶„ÄÅË©≤ÂΩì„Åô„Çã„Çª„É≥„Çµ„Éº„ÇíÁâπÂÆö„Åó„ÄÅÁîüÊàê„Çª„É≥„Çµ„ÉºÔºàgenerated sensorÔºâ„Å®ÂØæÂøú„Åô„ÇãÁâ©ÁêÜ„Çª„É≥„Çµ„ÉºÔºàphysical sensorÔºâ„ÅÆÊÉÖÂ†±„Çí‰ΩµË®ò„Åó„Å¶JSONÂΩ¢Âºè„ÅßÂõûÁ≠î„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

Âá¶ÁêÜÊâãÈ†ÜÔºö
1. „É¶„Éº„Ç∂„Éº„ÅÆË≥™Âïè„ÇíÂàÜÊûê„Åó„ÄÅÊ±Ç„ÇÅ„Çâ„Çå„Å¶„ÅÑ„Çã„Çª„É≥„Çµ„Éº„ÅÆÁ®ÆÈ°û„ÇÑË®≠ÁΩÆÂ†¥ÊâÄ„ÇíÁâπÂÆö„Åô„Çã
2. Âª∫Áâ©„Éá„Éº„Çø„ÅÆsensors„É™„Çπ„Éà„Åã„Çâ„ÄÅË≥™Âïè„Å´Ë©≤ÂΩì„Åô„Çã„Çª„É≥„Çµ„Éº„ÇíÊ§úÁ¥¢„Åô„ÇãÔºà„Çª„É≥„Çµ„ÉºÂêç„ÄÅ„Çø„Ç§„Éó„ÄÅË®≠ÁΩÆÂ†¥ÊâÄ„Å™„Å©„ÇíËÄÉÊÖÆÔºâ
3. ÁâπÂÆö„Åó„ÅüÂêÑ„Çª„É≥„Çµ„Éº„Å´„Å§„ÅÑ„Å¶„ÄÅ„Çª„É≥„Çµ„Éº„Éû„ÉÉ„Éî„É≥„Ç∞ÊÉÖÂ†±„Åã„ÇâÂØæÂøú„Åô„ÇãÁâ©ÁêÜ„Çª„É≥„Çµ„Éº„ÅÆÊÉÖÂ†±„ÇíÂèñÂæó„Åô„Çã
4. ÁµêÊûú„ÇíJSONÂΩ¢Âºè„ÅßÂá∫Âäõ„Åô„Çã

Âá∫ÂäõÂΩ¢ÂºèÔºö
\`\`\`json
{
  "sensorlist": [
    {
      "generated": "ÁîüÊàê„Çª„É≥„Çµ„ÉºÂêçÔºàgeneratedSensorNameÔºâ",
      "concrete": "Áâ©ÁêÜ„Çª„É≥„Çµ„ÉºÂêçÔºàphysicalSensorNameÔºâ"
    }
  ]
}
\`\`\`

Ê≥®ÊÑè‰∫ãÈ†ÖÔºö
- „Çª„É≥„Çµ„Éº„Éû„ÉÉ„Éî„É≥„Ç∞ÊÉÖÂ†±„Å´„Å™„ÅÑÁîüÊàê„Çª„É≥„Çµ„Éº„ÅÆÂ†¥Âêà„ÅØ„ÄÅ"concrete"„Éï„Ç£„Éº„É´„Éâ„Å´"„Éû„ÉÉ„Éî„É≥„Ç∞ÊÉÖÂ†±„Å™„Åó"„Å®Ë®òËºâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
- Ë≥™Âïè„Å´Ë©≤ÂΩì„Åô„Çã„Çª„É≥„Çµ„Éº„ÅåË§áÊï∞„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Åô„Åπ„Å¶„É™„Çπ„Éà„Å´Âê´„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ
- „Çª„É≥„Çµ„ÉºÂêç„ÅØÊ≠£Á¢∫„Å´„Éá„Éº„Çø„Åã„ÇâÂèñÂæó„Åó„Å¶„Åè„Å†„Åï„ÅÑ

Ë≥™ÂïèÔºö
{query}`);
                    alert('„Éá„Éï„Ç©„É´„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà„Å´Êàª„Åó„Åæ„Åó„Åü');
                }
            };

            const generatePromptPreview = () => {
                const exampleQuery = inputMessage || '‰ºöË≠∞ÂÆ§„ÅÆÊ∏©Â∫¶„Çª„É≥„Çµ„Éº„ÇíÊïô„Åà„Å¶';
                return promptTemplate
                    .replace('{buildingData}', JSON.stringify(buildingData, null, 2))
                    .replace('{sensorMappings}', JSON.stringify(sensorMappings, null, 2))
                    .replace('{query}', exampleQuery);
            };

            const toggleDebugExpand = (index) => {
                setExpandedDebug(prev => ({
                    ...prev,
                    [index]: !prev[index]
                }));
            };

            return (
                <>
                    <div className="toolbar">
                        <h2 style={{flex: 1, fontSize: '18px'}}>Ëá™ÁÑ∂Ë®ÄË™û„ÇØ„Ç®„É™</h2>
                        <button
                            className={`btn ${debugMode ? 'btn-primary' : 'btn-secondary'}`}
                            onClick={() => setDebugMode(!debugMode)}
                            style={{marginRight: '8px'}}
                            title="„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÅÆË°®Á§∫/ÈùûË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà"
                        >
                            {debugMode ? 'üêõ „Éá„Éê„ÉÉ„Ç∞ON' : 'üêõ „Éá„Éê„ÉÉ„Ç∞'}
                        </button>
                        <button
                            className="btn btn-secondary"
                            onClick={() => setShowPromptEditor(!showPromptEditor)}
                            style={{marginRight: '8px'}}
                        >
                            {showPromptEditor ? 'üìù „ÉÜ„É≥„Éó„É¨„Éº„ÉàÁ∑®ÈõÜ„ÇíÈñâ„Åò„Çã' : 'üìù „Éó„É≠„É≥„Éó„Éà„ÉÜ„É≥„Éó„É¨„Éº„ÉàÁ∑®ÈõÜ'}
                        </button>
                    </div>
                    <div className="content-area" style={{padding: 0, display: 'flex', flexDirection: 'column'}}>
                        {showPromptEditor && (
                            <div className="card" style={{margin: '20px', marginBottom: '10px'}}>
                                <h3>„Éó„É≠„É≥„Éó„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà</h3>
                                <p style={{fontSize: '13px', color: '#666', marginBottom: '12px'}}>
                                    API„Å´ÈÄÅ‰ø°„Åï„Çå„Çã„Éó„É≠„É≥„Éó„Éà„ÅÆ„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÁ∑®ÈõÜ„Åß„Åç„Åæ„Åô„ÄÇ
                                    <code>{'{buildingData}'}</code>„ÄÅ<code>{'{sensorMappings}'}</code>„ÄÅ<code>{'{query}'}</code> „ÅØ„Åù„Çå„Åû„ÇåÂÆüÈöõ„ÅÆ„Éá„Éº„Çø„Å´ÁΩÆ„ÅçÊèõ„Åà„Çâ„Çå„Åæ„Åô„ÄÇ
                                </p>
                                <div className="form-group">
                                    <textarea
                                        value={promptTemplate}
                                        onChange={(e) => setPromptTemplate(e.target.value)}
                                        rows="15"
                                        style={{fontFamily: 'monospace', fontSize: '13px', width: '100%'}}
                                        placeholder="„Éó„É≠„É≥„Éó„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÂÖ•Âäõ..."
                                    />
                                </div>
                                <div style={{display: 'flex', gap: '8px', marginTop: '8px'}}>
                                    <button
                                        className="btn btn-secondary"
                                        onClick={handleResetTemplate}
                                    >
                                        „Éá„Éï„Ç©„É´„Éà„Å´Êàª„Åô
                                    </button>
                                    <button
                                        className="btn btn-secondary"
                                        onClick={() => setShowPromptPreview(!showPromptPreview)}
                                    >
                                        {showPromptPreview ? '„Éó„É¨„Éì„É•„Éº„ÇíÈñâ„Åò„Çã' : '„Éó„É¨„Éì„É•„ÉºË°®Á§∫'}
                                    </button>
                                </div>
                                {showPromptPreview && (
                                    <div style={{marginTop: '16px'}}>
                                        <h4 style={{fontSize: '14px', marginBottom: '8px'}}>„Éó„É≠„É≥„Éó„Éà„Éó„É¨„Éì„É•„Éº</h4>
                                        <pre style={{
                                            background: '#f5f5f5',
                                            padding: '12px',
                                            borderRadius: '4px',
                                            fontSize: '12px',
                                            maxHeight: '300px',
                                            overflow: 'auto',
                                            whiteSpace: 'pre-wrap',
                                            wordWrap: 'break-word'
                                        }}>
                                            {generatePromptPreview()}
                                        </pre>
                                        <p style={{fontSize: '12px', color: '#666', marginTop: '8px'}}>
                                            ‚Äª ÂÖ•ÂäõÊ¨Ñ„Å´Ë≥™Âïè„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Åù„Çå„Çí‰ΩøÁî®„ÄÅ„Å™„Åë„Çå„Å∞„Çµ„É≥„Éó„É´Ë≥™Âïè„Çí‰ΩøÁî®„Åó„Å¶„Éó„É¨„Éì„É•„Éº„ÇíÁîüÊàê„Åó„Å¶„ÅÑ„Åæ„Åô
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}

                        <div className="instruction-box" style={{margin: '20px', marginBottom: '10px', marginTop: showPromptEditor ? '10px' : '20px'}}>
                            <h3>Ëá™ÁÑ∂Ë®ÄË™û„Åß„Çª„É≥„Çµ„Éº„ÇíÊ§úÁ¥¢</h3>
                            <p>
                                „Äå‰ºöË≠∞ÂÆ§„ÅÆÊ∏©Â∫¶„Çª„É≥„Çµ„Éº„ÇíÊïô„Åà„Å¶„Äç„Äå1Èöé„ÅÆ„Çª„É≥„Çµ„Éº‰∏ÄË¶ß„Äç„Å™„Å©„ÅÆËá™ÁÑ∂„Å™Êó•Êú¨Ë™û„Åß„ÄÅ
                                Âª∫Áâ©„Éá„Éº„Çø„Åã„ÇâË©≤ÂΩì„Åô„Çã„Çª„É≥„Çµ„Éº„ÇíÊ§úÁ¥¢„Åß„Åç„Åæ„Åô„ÄÇ„Éû„ÉÉ„Éî„É≥„Ç∞Ê∏à„Åø„ÅÆÂ†¥Âêà„ÅØÂÖ∑‰Ωì„Çª„É≥„Çµ„ÉºÂêç„ÇÇË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ
                            </p>
                        </div>

                        <div className="chat-container" style={{flex: 1}}>
                            <div className="chat-messages">
                                {messages.length === 0 ? (
                                    <div style={{textAlign: 'center', color: '#999', padding: '40px'}}>
                                        <p>Ë≥™Âïè„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                        <p style={{fontSize: '12px', marginTop: '8px'}}>
                                            ‰æã: „Äå‰ºöË≠∞ÂÆ§„ÅÆÊ∏©Â∫¶„Çª„É≥„Çµ„Éº„ÇíÊïô„Åà„Å¶„Äç
                                        </p>
                                    </div>
                                ) : (
                                    messages.map((msg, index) => (
                                        <div key={index}>
                                            <div className={`chat-message ${msg.role}`}>
                                                {msg.content}
                                            </div>
                                            {debugMode && msg.debug && (
                                                <div style={{
                                                    margin: '8px 20px',
                                                    padding: '12px',
                                                    background: '#f0f9ff',
                                                    border: '1px solid #bfdbfe',
                                                    borderRadius: '4px',
                                                    fontSize: '12px'
                                                }}>
                                                    <div style={{
                                                        display: 'flex',
                                                        justifyContent: 'space-between',
                                                        alignItems: 'center',
                                                        marginBottom: '8px',
                                                        cursor: 'pointer'
                                                    }} onClick={() => toggleDebugExpand(index)}>
                                                        <strong style={{color: '#1e40af'}}>üêõ „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±</strong>
                                                        <span style={{color: '#64748b'}}>
                                                            {expandedDebug[index] ? '‚ñº Èñâ„Åò„Çã' : '‚ñ∂ Â±ïÈñã'}
                                                        </span>
                                                    </div>
                                                    <div style={{
                                                        display: 'grid',
                                                        gridTemplateColumns: 'auto 1fr',
                                                        gap: '4px 12px',
                                                        color: '#475569'
                                                    }}>
                                                        <span style={{fontWeight: 'bold'}}>„É¢„Éº„Éâ:</span>
                                                        <span style={{
                                                            color: msg.debug.mode.includes('API Mode') ? '#16a34a' : '#dc2626',
                                                            fontWeight: 'bold',
                                                            fontSize: '13px'
                                                        }}>
                                                            {msg.debug.mode}
                                                        </span>

                                                        {msg.debug.apiCallSuccess !== undefined && (
                                                            <>
                                                                <span style={{fontWeight: 'bold'}}>APIÂëº„Å≥Âá∫„Åó:</span>
                                                                <span style={{
                                                                    color: msg.debug.apiCallSuccess ? '#16a34a' : '#dc2626',
                                                                    fontWeight: 'bold'
                                                                }}>
                                                                    {msg.debug.apiCallSuccess ? '‚úì ÊàêÂäü' : '‚úó Â§±Êïó/Êú™ÂÆüË°å'}
                                                                </span>
                                                            </>
                                                        )}

                                                        {msg.debug.simulationNote && (
                                                            <>
                                                                <span style={{fontWeight: 'bold'}}>Ê≥®ÊÑè:</span>
                                                                <span style={{color: '#dc2626', fontSize: '12px'}}>
                                                                    {msg.debug.simulationNote}
                                                                </span>
                                                            </>
                                                        )}

                                                        {msg.debug.errorMessage && (
                                                            <>
                                                                <span style={{fontWeight: 'bold'}}>„Ç®„É©„Éº:</span>
                                                                <span style={{color: '#dc2626', fontSize: '12px'}}>
                                                                    {msg.debug.errorMessage}
                                                                </span>
                                                            </>
                                                        )}

                                                        {msg.debug.isServerError && (
                                                            <>
                                                                <span style={{fontWeight: 'bold'}}>„Çµ„Éº„Éê„Éº„Ç®„É©„Éº:</span>
                                                                <span style={{
                                                                    color: '#dc2626',
                                                                    fontSize: '12px',
                                                                    fontWeight: 'bold',
                                                                    background: '#fee2e2',
                                                                    padding: '2px 6px',
                                                                    borderRadius: '3px'
                                                                }}>
                                                                    üîå „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„ÉºÊú™Ëµ∑Âãï - npm start „ÅßËµ∑Âãï
                                                                </span>
                                                            </>
                                                        )}

                                                        <span style={{fontWeight: 'bold'}}>„Éó„É≠„Éê„Ç§„ÉÄ„Éº:</span>
                                                        <span>{msg.debug.provider}</span>

                                                        <span style={{fontWeight: 'bold'}}>„É¢„Éá„É´:</span>
                                                        <span>{msg.debug.model}</span>

                                                        <span style={{fontWeight: 'bold'}}>„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà:</span>
                                                        <span style={{wordBreak: 'break-all'}}>{msg.debug.endpoint}</span>

                                                        <span style={{fontWeight: 'bold'}}>API„Ç≠„Éº:</span>
                                                        <span>{msg.debug.hasApiKey ? 'Ë®≠ÂÆöÊ∏à„Åø ‚úì' : 'Êú™Ë®≠ÂÆö ‚úó'}</span>

                                                        <span style={{fontWeight: 'bold'}}>„Éá„Éº„Çø„Çµ„Ç§„Ç∫:</span>
                                                        <span>{(msg.debug.buildingDataSize / 1024).toFixed(2)} KB</span>

                                                        <span style={{fontWeight: 'bold'}}>„Éû„ÉÉ„Éî„É≥„Ç∞Êï∞:</span>
                                                        <span>{msg.debug.sensorMappingsCount}</span>

                                                        <span style={{fontWeight: 'bold'}}>„É¨„Çπ„Éù„É≥„ÇπÈï∑:</span>
                                                        <span>{msg.debug.responseLength} ÊñáÂ≠ó</span>

                                                        <span style={{fontWeight: 'bold'}}>„Çø„Ç§„É†„Çπ„Çø„É≥„Éó:</span>
                                                        <span>{new Date(msg.debug.timestamp).toLocaleString('ja-JP')}</span>
                                                    </div>

                                                    {expandedDebug[index] && (
                                                        <>
                                                            <div style={{marginTop: '12px', paddingTop: '12px', borderTop: '1px solid #bfdbfe'}}>
                                                                <strong style={{color: '#1e40af'}}>ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åï„Çå„Çã„Éó„É≠„É≥„Éó„Éà:</strong>
                                                                <pre style={{
                                                                    marginTop: '8px',
                                                                    padding: '8px',
                                                                    background: '#fff',
                                                                    border: '1px solid #e2e8f0',
                                                                    borderRadius: '4px',
                                                                    fontSize: '11px',
                                                                    maxHeight: '400px',
                                                                    overflow: 'auto',
                                                                    whiteSpace: 'pre-wrap',
                                                                    wordWrap: 'break-word'
                                                                }}>
                                                                    {msg.debug.actualPrompt}
                                                                </pre>
                                                            </div>
                                                            <div style={{marginTop: '12px', paddingTop: '12px', borderTop: '1px solid #bfdbfe'}}>
                                                                <strong style={{color: '#1e40af'}}>„Éó„É≠„É≥„Éó„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà:</strong>
                                                                <pre style={{
                                                                    marginTop: '8px',
                                                                    padding: '8px',
                                                                    background: '#fff',
                                                                    border: '1px solid #e2e8f0',
                                                                    borderRadius: '4px',
                                                                    fontSize: '11px',
                                                                    maxHeight: '200px',
                                                                    overflow: 'auto',
                                                                    whiteSpace: 'pre-wrap',
                                                                    wordWrap: 'break-word'
                                                                }}>
                                                                    {msg.debug.promptTemplate}
                                                                </pre>
                                                            </div>
                                                            <div style={{marginTop: '12px', paddingTop: '12px', borderTop: '1px solid #bfdbfe'}}>
                                                                <strong style={{color: '#1e40af'}}>API„É¨„Çπ„Éù„É≥„Çπ:</strong>
                                                                <div style={{
                                                                    marginTop: '8px',
                                                                    display: 'grid',
                                                                    gridTemplateColumns: 'auto 1fr',
                                                                    gap: '4px 12px',
                                                                    fontSize: '11px',
                                                                    color: '#475569',
                                                                    marginBottom: '8px'
                                                                }}>
                                                                    <span style={{fontWeight: 'bold'}}>„É¨„Çπ„Éù„É≥„ÇπÈï∑:</span>
                                                                    <span>{msg.debug.responseLength} ÊñáÂ≠ó</span>
                                                                    <span style={{fontWeight: 'bold'}}>„É¨„Çπ„Éù„É≥„ÇπÊôÇÂàª:</span>
                                                                    <span>{new Date(msg.debug.responseTime).toLocaleString('ja-JP')}</span>
                                                                </div>
                                                                <pre style={{
                                                                    marginTop: '8px',
                                                                    padding: '8px',
                                                                    background: '#fff',
                                                                    border: '1px solid #e2e8f0',
                                                                    borderRadius: '4px',
                                                                    fontSize: '11px',
                                                                    maxHeight: '300px',
                                                                    overflow: 'auto',
                                                                    whiteSpace: 'pre-wrap',
                                                                    wordWrap: 'break-word'
                                                                }}>
                                                                    {msg.debug.rawResponse}
                                                                </pre>
                                                            </div>
                                                        </>
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    ))
                                )}
                            </div>
                            <div className="chat-input-area">
                                <div className="chat-input">
                                    <textarea
                                        value={inputMessage}
                                        onChange={(e) => setInputMessage(e.target.value)}
                                        onKeyPress={(e) => {
                                            if (e.key === 'Enter' && !e.shiftKey) {
                                                e.preventDefault();
                                                handleSend();
                                            }
                                        }}
                                        placeholder="Ë≥™Âïè„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."
                                        rows="3"
                                    />
                                    <button className="btn btn-primary" onClick={handleSend}>
                                        ÈÄÅ‰ø°
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </>
            );
        };

        // Ë®≠ÂÆö„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
        const Settings = ({ apiKey, setApiKey, apiProvider, setApiProvider, apiModel, setApiModel, apiEndpoint, setApiEndpoint }) => {
            const [savedConfig, setSavedConfig] = useState(false);

            const handleSaveConfig = () => {
                // LocalStorage„Å´‰øùÂ≠òÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
                try {
                    localStorage.setItem('apiConfig', JSON.stringify({
                        provider: apiProvider,
                        model: apiModel,
                        endpoint: apiEndpoint
                    }));
                    setSavedConfig(true);
                    alert('APIË®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                    setTimeout(() => setSavedConfig(false), 3000);
                } catch (e) {
                    console.error('Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', e);
                }
            };

            const getModelOptions = () => {
                switch (apiProvider) {
                    case 'openai':
                        return [
                            { value: 'gpt-4o', label: 'GPT-4o' },
                            { value: 'gpt-4o-mini', label: 'GPT-4o Mini' },
                            { value: 'gpt-4-turbo', label: 'GPT-4 Turbo' },
                            { value: 'gpt-4', label: 'GPT-4' },
                            { value: 'gpt-3.5-turbo', label: 'GPT-3.5 Turbo' }
                        ];
                    case 'anthropic':
                        return [
                            { value: 'claude-sonnet-4-5', label: 'Claude Sonnet 4.5' },
                            { value: 'claude-haiku-4-5', label: 'Claude Haiku 4.5' },
                            { value: 'claude-3-5-sonnet-20241022', label: 'Claude 3.5 Sonnet (Legacy)' },
                            { value: 'claude-3-opus-20240229', label: 'Claude 3 Opus (Legacy)' }
                        ];
                    case 'google':
                        return [
                            { value: 'gemini-2.0-flash-exp', label: 'Gemini 2.0 Flash (Experimental)' },
                            { value: 'gemini-1.5-pro', label: 'Gemini 1.5 Pro' },
                            { value: 'gemini-1.5-flash', label: 'Gemini 1.5 Flash' },
                            { value: 'gemini-pro', label: 'Gemini Pro' }
                        ];
                    default:
                        return [];
                }
            };

            const getDefaultEndpoint = () => {
                switch (apiProvider) {
                    case 'openai':
                        return 'https://api.openai.com/v1';
                    case 'anthropic':
                        return 'https://api.anthropic.com/v1';
                    case 'google':
                        return 'https://generativelanguage.googleapis.com/v1';
                    default:
                        return '';
                }
            };

            const isConfigured = apiKey && apiKey.length > 0;

            return (
                <>
                    <div className="toolbar">
                        <h2 style={{flex: 1, fontSize: '18px'}}>APIË®≠ÂÆö</h2>
                        <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                            <span className={`status-indicator ${isConfigured ? 'status-connected' : 'status-disconnected'}`}></span>
                            <span style={{fontSize: '14px', color: isConfigured ? '#48bb78' : '#f56565'}}>
                                {isConfigured ? 'APIË®≠ÂÆöÊ∏à„Åø' : 'APIÊú™Ë®≠ÂÆö'}
                            </span>
                        </div>
                    </div>
                    <div className="content-area">
                        {!isConfigured && (
                            <div className="api-config">
                                <h3>‚ö†Ô∏è APIË®≠ÂÆö„ÅåÂøÖË¶Å„Åß„Åô</h3>
                                <p style={{fontSize: '13px', color: '#92400e', marginTop: '8px'}}>
                                    AI„Éû„ÉÉ„Éî„É≥„Ç∞„Å®Ëá™ÁÑ∂Ë®ÄË™û„ÇØ„Ç®„É™„Çí‰ΩøÁî®„Åô„Çã„Å´„ÅØ„ÄÅAPI„Ç≠„Éº„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                                    ÁèæÂú®„ÅÆÂÆüË£Ö„ÅØ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„É¢„Éº„Éâ„ÅßÂãï‰Ωú„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
                                </p>
                            </div>
                        )}

                        <div className="api-config" style={{background: '#dcfce7', border: '1px solid #22c55e'}}>
                            <h3>‚úÖ „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„ÉºÁµåÁî±„ÅßAPIÂëº„Å≥Âá∫„Åó</h3>
                            <p style={{fontSize: '13px', color: '#166534', marginTop: '8px', marginBottom: '8px'}}>
                                <strong>„Åì„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅØ„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„ÉºÁµåÁî±„ÅßAPIÂëº„Å≥Âá∫„Åó„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇ</strong>
                                CORS„Ç®„É©„Éº„ÅÆÂøÉÈÖç„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
                            </p>
                            <p style={{fontSize: '12px', color: '#166534', marginBottom: '8px'}}>
                                <strong>„Çµ„Éº„Éê„Éº„ÅÆËµ∑ÂãïÊñπÊ≥ï:</strong>
                            </p>
                            <ol style={{fontSize: '12px', color: '#166534', marginLeft: '20px', marginBottom: '8px'}}>
                                <li>„Çø„Éº„Éü„Éä„É´„ÇíÈñã„Åè</li>
                                <li><code>cd workbench</code> „Åß„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´ÁßªÂãï</li>
                                <li><code>npm install</code> „Åß‰æùÂ≠ò„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Ç§„É≥„Çπ„Éà„Éº„É´ÔºàÂàùÂõû„ÅÆ„ÅøÔºâ</li>
                                <li><code>npm start</code> „Åß„Çµ„Éº„Éê„Éº„ÇíËµ∑Âãï</li>
                                <li>„Éñ„É©„Ç¶„Ç∂„Åß <code>http://localhost:3001/building_model_workbench.html</code> „Å´„Ç¢„ÇØ„Çª„Çπ</li>
                            </ol>
                            <p style={{fontSize: '12px', color: '#166534'}}>
                                <strong>„Çª„Ç≠„É•„É™„ÉÜ„Ç£:</strong> API„Ç≠„Éº„ÅØ„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„Éº„ÅåÂÆâÂÖ®„Å´ÁÆ°ÁêÜ„Åó„Åæ„Åô„ÄÇ„Éñ„É©„Ç¶„Ç∂„Å´Èú≤Âá∫„Åó„Åæ„Åõ„Çì„ÄÇ
                            </p>
                            <p style={{fontSize: '12px', color: '#166534', marginTop: '8px'}}>
                                Ë©≥Á¥∞„ÅØ <code>README_SERVER.md</code> „ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                            </p>
                        </div>

                        <div className="card">
                            <h2>AI APIË®≠ÂÆö</h2>

                            <div className="form-group">
                                <label>AI„Éó„É≠„Éê„Ç§„ÉÄ„Éº</label>
                                <select
                                    value={apiProvider}
                                    onChange={(e) => {
                                        setApiProvider(e.target.value);
                                        // „Éó„É≠„Éê„Ç§„ÉÄ„ÉºÂ§âÊõ¥ÊôÇ„Å´„Éá„Éï„Ç©„É´„Éà„É¢„Éá„É´„ÇíË®≠ÂÆö
                                        const provider = e.target.value;
                                        if (provider === 'openai') setApiModel('gpt-4o-mini');
                                        else if (provider === 'anthropic') setApiModel('claude-sonnet-4-5');
                                        else if (provider === 'google') setApiModel('gemini-1.5-flash');
                                        setApiEndpoint('');
                                    }}
                                >
                                    <option value="openai">OpenAI</option>
                                    <option value="anthropic">Anthropic (Claude)</option>
                                    <option value="google">Google (Gemini)</option>
                                </select>
                            </div>

                            <div className="form-group">
                                <label>„É¢„Éá„É´</label>
                                <select
                                    value={apiModel}
                                    onChange={(e) => setApiModel(e.target.value)}
                                >
                                    {getModelOptions().map(option => (
                                        <option key={option.value} value={option.value}>{option.label}</option>
                                    ))}
                                </select>
                            </div>

                            <div className="form-group">
                                <label>API„Ç≠„Éº</label>
                                <input
                                    type="password"
                                    value={apiKey}
                                    onChange={(e) => setApiKey(e.target.value)}
                                    placeholder={
                                        apiProvider === 'openai' ? 'sk-...' :
                                        apiProvider === 'anthropic' ? 'sk-ant-...' :
                                        'API „Ç≠„Éº„ÇíÂÖ•Âäõ'
                                    }
                                />
                                <p style={{fontSize: '12px', color: '#666', marginTop: '4px'}}>
                                    {apiProvider === 'openai' && 'OpenAI API„Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàhttps://platform.openai.com/api-keysÔºâ'}
                                    {apiProvider === 'anthropic' && 'Anthropic API„Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàhttps://console.anthropic.com/Ôºâ'}
                                    {apiProvider === 'google' && 'Google AI Studio API„Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàhttps://aistudio.google.com/app/apikeyÔºâ'}
                                </p>
                            </div>

                            <div className="form-group">
                                <label>API„Ç®„É≥„Éâ„Éù„Ç§„É≥„ÉàÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ</label>
                                <input
                                    type="text"
                                    value={apiEndpoint}
                                    onChange={(e) => setApiEndpoint(e.target.value)}
                                    placeholder={getDefaultEndpoint()}
                                />
                                <p style={{fontSize: '12px', color: '#666', marginTop: '4px'}}>
                                    „Ç´„Çπ„Çø„É†„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà„Çí‰ΩøÁî®„Åô„ÇãÂ†¥Âêà„ÅÆ„ÅøÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÁ©∫Ê¨Ñ„ÅÆÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„Éà„Åå‰ΩøÁî®„Åï„Çå„Åæ„Åô„ÄÇ
                                </p>
                            </div>

                            <button
                                className={`btn ${savedConfig ? 'btn-secondary' : 'btn-success'}`}
                                onClick={handleSaveConfig}
                            >
                                {savedConfig ? '‚úì ‰øùÂ≠òÊ∏à„Åø' : 'Ë®≠ÂÆö„Çí‰øùÂ≠ò'}
                            </button>
                        </div>

                        <div className="card">
                            <h2>ÁèæÂú®„ÅÆË®≠ÂÆö</h2>
                            <div style={{fontSize: '14px', lineHeight: '1.8'}}>
                                <div><strong>„Éó„É≠„Éê„Ç§„ÉÄ„Éº:</strong> {
                                    apiProvider === 'openai' ? 'OpenAI' :
                                    apiProvider === 'anthropic' ? 'Anthropic (Claude)' :
                                    apiProvider === 'google' ? 'Google (Gemini)' : '-'
                                }</div>
                                <div><strong>„É¢„Éá„É´:</strong> {apiModel || '-'}</div>
                                <div><strong>API„Ç≠„Éº:</strong> {apiKey ? 'Ë®≠ÂÆöÊ∏à„Åø (‚óè‚óè‚óè‚óè‚óè‚óè)' : 'Êú™Ë®≠ÂÆö'}</div>
                                <div><strong>„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà:</strong> {apiEndpoint || getDefaultEndpoint()}</div>
                            </div>
                        </div>

                        <div className="card">
                            <h2>„Éá„Éº„Çø„Éë„ÇπË®≠ÂÆö</h2>
                            <div className="form-group">
                                <label>„Ç™„É≥„Éà„É≠„Ç∏„Éº„Éï„Ç°„Ç§„É´„Éë„Çπ</label>
                                <input
                                    type="text"
                                    value="./building_ontology.ttl"
                                    readOnly
                                />
                            </div>
                        </div>
                    </div>
                </>
            );
        };

        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        ReactDOM.render(<BuildingModelWorkbench />, document.getElementById('root'));
    </script>
</body>
</html>
